---
title: 모든 키 자격 증명 모음 개체에 대해 일시 삭제를 사용하도록 설정 | Microsoft Docs
description: 이 문서를 사용하여 모든 키 자격 증명 모음에 대해 일시 삭제를 적용하고 충돌 오류를 방지하기 위해 애플리케이션 및 관리를 변경할 수 있습니다.
services: key-vault
author: msmbaldwin
tags: azure-resource-manager
ms.service: key-vault
ms.topic: conceptual
ms.date: 03/31/2021
ms.author: mbaldwin
ms.openlocfilehash: 45eea8f8809e97f7e424a988140bcf76b47d5947
ms.sourcegitcommit: 0ede6bcb140fe805daa75d4b5bdd2c0ee040ef4d
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/20/2021
ms.locfileid: "122609287"
---
# <a name="soft-delete-will-be-enabled-on-all-key-vaults"></a>모든 키 자격 증명 모음에 대해 일시 삭제를 사용하도록 설정됩니다.

> [!WARNING]
> 호환성이 손상되는 변경: 일시 삭제를 옵트아웃하는 기능은 곧 더 이상 사용되지 않습니다. Azure Key Vault 사용자와 관리자는 즉시 키 자격 증명 모음에 대해 일시 삭제를 사용하도록 설정해야 합니다.
>
> Azure Key Vault 관리형 HSM의 경우 일시 삭제를 기본적으로 사용하도록 설정되어 있으며, 이를 해제할 수 없습니다.

키 자격 증명 모음에 대해 일시 삭제 보호를 사용하지 않고 비밀을 삭제하면 해당 비밀이 영구적으로 삭제됩니다. 사용자는 현재 키 자격 증명 모음 생성 중에 일시 삭제를 옵트아웃할 수 있습니다. 그러나 Microsoft는 곧 모든 키 자격 증명 모음에서 일시 삭제를 사용하도록 설정하여 사용자가 실수로 또는 악의적으로 삭제하지 못하도록 비밀을 보호합니다. 사용자는 더 이상 일시 삭제를 옵트아웃 또는 해제할 수 없습니다.

:::image type="content" source="../media/softdeletediagram.png" alt-text="일시 삭제 보호를 사용하는 경우와 일시 삭제 보호를 사용하지 않는 경우 키 자격 증명 모음을 삭제하는 방법을 보여주는 다이어그램.":::

일시 삭제 기능에 대한 자세한 내용은 [Azure Key Vault 일시 삭제 개요](soft-delete-overview.md)를 참조하세요.

## <a name="can-my-application-work-with-soft-delete-enabled"></a>일시 삭제를 사용하도록 설정한 상태에서 애플리케이션이 작동할 수 있나요?

> [!Important] 
> 키 자격 증명 모음에 일시 삭제를 설정하기 전에 다음 정보를 주의 깊게 검토하세요.

키 자격 증명 모음 이름은 전역적으로 고유합니다. 키 자격 증명 모음에 저장된 비밀의 이름도 고유합니다. 일시 삭제된 상태의 키 자격 증명 모음 또는 키 자격 증명 모음 개체의 이름은 다시 사용할 수 없습니다. 

예를 들어, 애플리케이션이 "Vault A"라는 키 자격 증명 모음을 프로그래밍 방식으로 만들고 나중에 "Vault A"를 삭제하는 경우 키 자격 증명 모음은 일시 삭제 상태로 이동됩니다. 애플리케이션은 키 자격 증명 모음이 일시 삭제된 상태에서 해제될 때까지 "Vault A"라는 이름의 다른 키 자격 증명 모음을 다시 만들 수 없습니다. 

또한 애플리케이션이 "Vault A"에 `test key`라는 키를 만들고 나중에 이 키를 삭제하면, `test key` 개체가 일시 삭제된 상태에서 제거될 때까지 애플리케이션은 "Vault A"에서 `test key`라는 새 키를 만들 수 없습니다. 

키 자격 증명 모음 개체를 삭제하고 먼저 일시 삭제된 상태에서 제거하지 않고 동일한 이름으로 다시 만들려고 하면 충돌 오류가 발생할 수 있습니다. 이러한 오류로 인해 애플리케이션 또는 자동화가 실패할 수 있습니다. 다음의 필수 애플리케이션 및 관리를 변경하기 전에 개발 팀에 문의하세요. 

### <a name="application-changes"></a>애플리케이션 변경

애플리케이션에서 일시 삭제를 사용하도록 설정하지 않는다고 가정하고 삭제된 비밀 또는 키 자격 증명 모음 이름을 즉시 다시 사용할 수 있다고 예상하는 경우 다음 변경 내용을 애플리케이션 논리에 적용해야 합니다.

1. 원래 키 자격 증명 모음 또는 비밀을 삭제합니다.
1. 일시 삭제된 상태의 키 자격 증명 모음 또는 비밀을 제거합니다.
1. 제거가 완료될 때까지 기다립니다. 바로 다시 만들면 충돌이 발생할 수 있습니다.
1. 키 자격 증명 모음을 동일한 이름으로 다시 만듭니다.
1. 만들기 작업에서 계속 이름 충돌 오류가 발생하면 키 자격 증명 모음을 다시 만들어보세요. Azure DNS 레코드는 최악의 시나리오에서 업데이트하는 데 최대 10분이 소요될 수 있습니다.

### <a name="administration-changes"></a>관리 변경

비밀을 영구적으로 삭제할 수 있는 액세스 권한이 필요한 보안 주체는 이러한 비밀과 키 자격 증명 모음을 제거하기 위해 더 많은 액세스 정책 권한을 부여받아야 합니다.

일시 삭제를 해제하도록 하는 키 자격 증명 모음에서 Azure Policy 할당을 사용하지 않도록 설정합니다. 사용자 환경에 적용된 Azure Policy 할당을 관리하는 관리자에게 이 문제를 에스컬레이션해야 할 수 있습니다. 이 정책 할당이 비활성화되어 있지 않으면 적용된 정책 할당의 범위에서 새 키 자격 증명 모음을 만들 수 없게 됩니다.

조직에서 법적 규정 준수 요구 사항을 따르고 있고 삭제된 키 자격 증명 모음과 비밀을 연장 기간 동안 복구 가능한 상태로 유지하도록 허용할 수 없는 경우 일시 삭제 보존 기간을 조직의 표준에 맞게 조정해야 합니다. 보존 기간은 7일에서 90일까지 지속되도록 구성할 수 있습니다.

## <a name="procedures"></a>프로시저

### <a name="audit-your-key-vaults-to-check-if-soft-delete-is-enabled"></a>키 자격 증명 모음을 감사하여 일시 삭제를 사용하도록 설정되었는지 확인

1. Azure Portal에 로그인합니다.
1. **Azure Policy** 를 검색합니다.
1. **정의** 를 선택합니다.
1. **범주** 의 필터에서 **Key Vault** 를 선택합니다.
1. **키 자격 증명 모음에서 일시 삭제를 사용하도록 설정해야 함** 정책을 선택합니다.
1. **할당** 을 선택합니다.
1. 범위를 구독으로 설정합니다.
1. 정책의 효과가 **감사** 로 설정되어 있는지 확인합니다.
1. **검토 + 만들기** 를 선택합니다. 전체 환경 검색을 완료하는 데 최대 24시간이 걸릴 수 있습니다.
1. **Azure Policy** 창에서 **규정 준수** 를 클릭합니다.
1. 적용한 정책을 선택합니다.

이제 일시 삭제를 사용하도록 설정된 키 자격 증명 모음(준수 리소스) 및 일시 삭제를 사용하도록 설정하지 않은 키 자격 증명 모음(비준수 리소스)을 필터링하여 확인할 수 있습니다.

### <a name="turn-on-soft-delete-for-an-existing-key-vault"></a>기존 키 자격 증명 모음에 대해 일시 삭제 설정

1. Azure Portal에 로그인합니다.
1. 키 자격 증명 모음을 검색합니다.
1. **설정** 아래에서 **속성** 을 선택합니다.
1. **일시 삭제** 아래에서 **이 자격 증명 모음 및 해당 개체 복구 사용** 옵션을 선택합니다.
1. 일시 삭제 보존 기간을 설정합니다.
1. **저장** 을 선택합니다.

### <a name="grant-purge-access-policy-permissions-to-a-security-principal"></a>보안 주체에 제거 액세스 정책 권한 부여

1. Azure Portal에 로그인합니다.
1. 키 자격 증명 모음을 검색합니다.
1. **설정** 에서 **액세스 정책** 을 선택합니다.
1. 액세스 권한을 부여하려는 서비스 주체를 선택합니다.
1. **권한 있는 작업** 이 표시될 때까지 **키**, **비밀**, **인증서 권한** 아래의 각 드롭다운 메뉴를 이동합니다. **제거** 권한을 선택합니다.

## <a name="frequently-asked-questions"></a>질문과 대답

### <a name="does-this-change-affect-me"></a>이 변경이 내게 영향을 주나요?

일시 삭제를 이미 설정했거나 키 자격 증명 모음 개체를 삭제하고 동일한 이름으로 다시 만들지 않으면 키 자격 증명 모음의 동작이 변경되지 않을 수 있습니다.

동일한 명명 규칙을 사용하여 키 자격 증명 모음 개체를 자주 삭제하고 다시 만드는 애플리케이션이 있는 경우 필요한 동작을 유지하려면 애플리케이션 논리를 변경해야 합니다. 이 문서의 [애플리케이션 변경](#application-changes) 섹션을 참조하세요.

### <a name="how-do-i-benefit-from-this-change"></a>이 변경으로 인해 얻을 수 있는 이점은 무엇인가요?

일시 삭제 보호는 실수로 또는 악의적으로 삭제되지 않도록 방지하는 또 다른 보호 계층을 조직에 제공합니다. 키 자격 증명 모음 관리자는 복구 권한 및 제거 권한 모두에 대한 액세스를 제한할 수 있습니다.

사용자가 실수로 키 자격 증명 모음 또는 비밀을 삭제하는 경우 비밀 또는 키 자격 증명 모음을 영구적으로 삭제하는 위험 없이 비밀 자체를 복구할 수 있는 액세스 권한을 부여할 수 있습니다. 이 셀프 서비스 프로세스는 환경의 가동 중지 시간을 최소화하고 비밀의 가용성을 보장합니다.

### <a name="how-do-i-find-out-if-i-need-to-take-action"></a>작업을 수행해야 하는지 여부를 확인하려면 어떻게 해야 하나요?

이 문서의 [일시 삭제를 사용하는지 확인하기 위해 키 자격 증명 모음 감사](#audit-your-key-vaults-to-check-if-soft-delete-is-enabled) 단계를 따릅니다. 이 변경 내용은 일시 삭제가 설정되지 않은 키 자격 증명 모음에 영향을 줍니다.

### <a name="what-action-do-i-need-to-take"></a>수행해야 하는 작업은 무엇인가요?

애플리케이션 로직을 변경할 필요가 없음을 확인한 후 모든 키 자격 증명 모음에서 일시 삭제를 설정합니다.

### <a name="when-do-i-need-to-take-action"></a>언제 작업을 수행해야 하나요?

애플리케이션에서 영향을 받지 않도록 하려면 최대한 빨리 키 자격 증명 모음에 대해 일시 삭제를 설정합니다.

## <a name="next-steps"></a>다음 단계

- 이 변경과 관련된 질문이 있는 경우 [akvsoftdelete@microsoft.com](mailto:akvsoftdelete@microsoft.com)으로 문의하세요.
- [일시 삭제 개요](soft-delete-overview.md)를 참조하세요.
