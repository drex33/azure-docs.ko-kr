---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 10/21/2020
ms.author: ccompy
ms.openlocfilehash: 399ce5e8714eb6935e3c2eac06ed44b712a14e35
ms.sourcegitcommit: 0046757af1da267fc2f0e88617c633524883795f
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/13/2021
ms.locfileid: "122536395"
---
지역 VNet 통합을 사용하면 앱에서 다음에 액세스할 수 있습니다.

* 앱과 동일한 지역에 있는 VNet의 리소스
* 앱이 통합된 VNet에 피어링된 VNet의 리소스
* 서비스 엔드포인트 보안 서비스
* Azure ExpressRoute 연결의 리소스
* 통합된 VNet의 리소스
* Azure ExpressRoute 연결을 포함하는 피어링된 연결의 리소스
* 프라이빗 엔드포인트 

동일한 지역에서 VNet과 VNet 통합을 사용하는 경우 다음과 같은 Azure 네트워킹 기능을 사용할 수 있습니다.

* **NSG(네트워크 보안 그룹)** : 통합 서브넷에 배치된 NSG를 사용하여 아웃바운드 트래픽을 차단할 수 있습니다. 인바운드 규칙은 적용되지 않습니다. VNet 통합을 사용하여 앱에 대한 인바운드 액세스를 제공할 수 없기 때문입니다.
* **경로 테이블(UDR)** : 통합 서브넷에 경로 테이블을 배치하여 원하는 위치에 아웃바운드 트래픽을 보낼 수 있습니다.

기본적으로 앱은 RFC1918 트래픽만 VNet으로 라우팅합니다. 모든 아웃바운드 트래픽을 VNet으로 라우팅하려면 다음 단계를 사용하여 앱에 `WEBSITE_VNET_ROUTE_ALL` 설정을 추가합니다. 

1. 앱 포털에서 **구성** UI로 이동합니다. **새 애플리케이션 설정** 을 선택합니다.
1. **이름** 상자에 `WEBSITE_VNET_ROUTE_ALL`을 입력하고 **값** 상자에 `1`을 입력합니다.

   ![애플리케이션 설정 제공][4]

1. **확인** 을 선택합니다.
1. **저장** 을 선택합니다.

> [!NOTE]
> 모든 아웃바운드 트래픽을 VNet으로 라우팅하면 통합 서브넷에 적용되는 NSG 및 UDR이 적용됩니다. `WEBSITE_VNET_ROUTE_ALL`을 `1`로 설정하면 트래픽을 다른 곳으로 보내는 경로를 제공하지 않는 한 앱 속성에 나열된 주소에서 공용 IP 주소에 대한 아웃바운드 트래픽이 계속 전송됩니다.
> 
> 지역 VNet 통합은 포트 25를 사용할 수 없습니다.

동일한 지역에서 VNet과 VNet 통합을 사용하는 경우 몇 가지 제한 사항이 있습니다.

* 글로벌 피어링 연결에서 리소스에 연결할 수 없습니다.
* 이 기능은 프리미엄 V2 및 프리미엄 V3의 모든 App Service 배율 단위에서 사용할 수 있습니다. 표준에서도 사용할 수 있지만 최신 App Service 배율 단위에서만 사용할 수 있습니다. 이전 배율 단위를 사용하는 경우 프리미엄 V2 App Service 요금제의 기능만 사용할 수 있습니다. 표준 App Service 요금제에서 이 기능을 사용할 수 있도록 하려면 프리미엄 V3 App Service 요금제에서 앱을 만듭니다. 이러한 플랜은 최신 배율 단위에서만 지원됩니다. 그 후에 원하는 경우 스케일 다운할 수 있습니다.  
* 통합 서브넷은 App Service 요금제 하나에서만 사용할 수 있습니다.
* 이 기능은 App Service Environment에 있는 격리 요금제 앱에서 사용할 수 없습니다.
* 이 기능에는 Azure Resource Manager VNet에서 /28 이상의 사용하지 않는 서브넷이 필요합니다.
* 앱과 VNet은 동일한 지역에 있어야 합니다.
* 통합된 앱이 있는 VNet은 삭제할 수 없습니다. VNet을 삭제하기 전에 통합을 제거하세요.
* 지역 VNet 통합은 App Service 요금제당 하나만 가능합니다. 동일한 App Service 요금제의 여러 앱에서 동일한 VNet을 사용할 수 있습니다.
* 지역 VNet 통합을 사용하는 앱이 있는 경우에는 앱 또는 플랜의 구독을 변경할 수 없습니다.
* 앱은 구성 변경 없이 Azure DNS Private Zones의 주소를 확인할 수 없습니다.

VNet 통합은 전용 서브넷에 따라 다릅니다. 서브넷을 프로비전할 때 Azure 서브넷은 처음부터 5개의 IP를 잃습니다. 각 플랜 인스턴스에 대해 통합 서브넷에서 하나의 주소가 사용됩니다. 앱을 4개의 인스턴스로 스케일링하면 4개의 주소가 사용됩니다. 

크기를 스케일 업 또는 스케일 다운하면, 짧은 시간 동안 필요한 주소 공간이 2배가 됩니다. 이렇게 되면 지정된 서브넷 크기에 대해 실제로 사용 가능한 지원되는 인스턴스에 영향을 줍니다. 다음 표는 CIDR 블록당 사용 가능한 최대 주소와 이것이 수평 스케일링에 미치는 영향을 보여줍니다.

| CIDR 블록 크기 | 사용 가능한 최대 주소 | 최대 수평 스케일링(인스턴스)<sup>*</sup> |
|-----------------|-------------------------|---------------------------------|
| /28             | 11                      | 5                               |
| /27             | 27                      | 13                              |
| /26             | 59                      | 29                              |

<sup>*</sup>어느 시점에서든 SKU 또는 크기를 스케일 업 또는 스케일 다운해야 한다고 가정합니다. 

할당 후에는 서브넷 크기를 변경할 수 없으므로 앱이 도달할 수 있는 모든 규모를 수용할 수 있을 정도로 충분히 큰 서브넷을 사용합니다. 서브넷 용량 관련 문제를 방지하려면 주소가 64개인 /26을 사용해야 합니다.  

다른 플랜의 앱이 다른 플랜의 앱을 통해 이미 연결된 VNet에 도달하도록 하려면 기존 VNet 통합에서 사용 중인 서브넷과 다른 서브넷을 선택합니다.

이 기능은 [사용자 지정 컨테이너](../articles/app-service/quickstart-custom-container.md)를 포함하여 Windows 및 Linux 앱 모두에서 완벽하게 지원됩니다. 모든 동작은 Windows 앱과 Linux 앱 간에 동일하게 작동합니다.

### <a name="service-endpoints"></a>서비스 엔드포인트

지역 VNet 통합을 사용하면 서비스 엔드포인트로 보안이 유지되는 Azure 서비스에 연결할 수 있습니다. 서비스 엔드포인트 보안 서비스에 액세스하려면 다음을 수행해야 합니다.

1. 통합을 위해 특정 서브넷에 연결하도록 웹앱과 지역 VNet 통합을 구성합니다.
1. 대상 서비스로 이동하여 통합 서브넷에 대해 서비스 엔드포인트를 구성합니다.

### <a name="network-security-groups"></a>네트워크 보안 그룹

네트워크 보안 그룹을 사용하여 VNet의 리소스에 대한 인바운드 및 아웃바운드 트래픽을 차단할 수 있습니다. 지역 VNet 통합을 사용하는 앱은 [네트워크 보안 그룹][VNETnsg]을 사용하여 VNet 또는 인터넷의 리소스에 대한 아웃바운드 트래픽을 차단할 수 있습니다. 공용 주소에 대한 트래픽을 차단하려면 애플리케이션 설정 `WEBSITE_VNET_ROUTE_ALL`을 `1`로 설정해야 합니다. NSG의 인바운드 규칙은 앱에 적용되지 않습니다. VNet 통합은 앱의 아웃바운드 트래픽에만 영향을 미치기 때문입니다.

앱에 대한 인바운드 트래픽을 제어하려면 액세스 제한 기능을 사용합니다. 통합 서브넷에 적용된 NSG는 통합 서브넷에 적용된 경로에 관계없이 적용됩니다. `WEBSITE_VNET_ROUTE_ALL`이 `1`로 설정되어 있고 통합 서브넷의 공용 주소 트래픽에 영향을 주는 경로가 없어도 모든 아웃바운드 트래픽은 여전히 통합 서브넷에 할당된 NSG의 적용을 받습니다. `WEBSITE_VNET_ROUTE_ALL`이 설정되지 않은 경우 NSG는 RFC1918 트래픽에만 적용됩니다.

### <a name="routes"></a>경로

경로 테이블을 사용하여 앱의 아웃바운드 트래픽을 원하는 위치로 라우팅할 수 있습니다. 기본적으로 경로 테이블은 RFC1918 대상 트래픽에만 영향을 줍니다. `WEBSITE_VNET_ROUTE_ALL`을 `1`로 설정하면 모든 아웃바운드 호출이 영향을 받습니다. 통합 서브넷에 설정된 경로는 인바운드 앱 요청에 대한 응답에 영향을 주지 않습니다. 일반적인 대상에는 방화벽 디바이스나 게이트웨이가 포함될 수 있습니다.

모든 아웃바운드 트래픽을 온-프레미스로 라우팅하려면 경로 테이블을 사용하여 모든 아웃바운드 트래픽을 ExpressRoute 게이트웨이로 보낼 수 있습니다. 게이트웨이로 트래픽을 라우팅하는 경우에는 응답을 다시 보내도록 외부 네트워크에서 경로를 설정해야 합니다.

BGP(Border Gateway Protocol) 경로도 앱 트래픽에 영향을 줍니다. ExpressRoute 게이트웨이와 같은 항목의 BGP 경로가 있는 경우 앱 아웃바운드 트래픽이 영향을 받습니다. 기본적으로 BGP 경로는 RFC1918 대상 트래픽에만 영향을 줍니다. `WEBSITE_VNET_ROUTE_ALL`을 `1`로 설정하면 모든 아웃바운드 트래픽이 BGP 경로의 영향을 받을 수 있습니다.

### <a name="azure-dns-private-zones"></a>Azure DNS 프라이빗 영역 

앱이 VNet과 통합되면 VNet이 구성된 것과 동일한 DNS 서버를 사용합니다. 기본적으로 앱은 Azure DNS 프라이빗 영역에서 작동하지 않습니다. Azure DNS 프라이빗 영역을 사용하려면 다음 앱 설정을 추가해야 합니다.

1. 값이 `168.63.129.16`인 `WEBSITE_DNS_SERVER`
1. 값이 `1`인 `WEBSITE_VNET_ROUTE_ALL`

이러한 설정은 앱의 모든 아웃바운드 호출을 VNet으로 보내고 앱이 Azure DNS 프라이빗 영역에 액세스할 수 있도록 합니다. 이러한 설정을 통해 앱은 작업자 수준에서 DNS 프라이빗 영역을 쿼리하여 Azure DNS를 사용할 수 있습니다.  

### <a name="private-endpoints"></a>프라이빗 엔드포인트

[프라이빗 엔드포인트][privateendpoints]를 호출하려면 DNS 조회가 프라이빗 엔드포인트로 확인되는지 확인해야 합니다. 이러한 동작은 다음 방법 중 하나로 적용할 수 있습니다. 

* Azure DNS 프라이빗 영역과 통합합니다. VNet에 사용자 지정 DNS 서버가 없으면 자동으로 수행됩니다.
* 앱에서 사용하는 DNS 서버에서 프라이빗 엔드포인트를 관리합니다. 이렇게 하려면 프라이빗 엔드포인트 주소를 알고 있어야 하며, A 레코드를 사용하여 해당 주소에 도달하려는 엔드포인트를 가리켜야 합니다.
* Azure DNS 프라이빗 영역으로 전달하도록 자체 DNS 서버를 구성합니다.

<!--Image references-->
[4]: ../includes/media/web-sites-integrate-with-vnet/vnetint-appsetting.png

<!--Links-->
[VNETnsg]: /azure/virtual-network/security-overview/
[privateendpoints]: ../articles/app-service/networking/private-endpoint.md
