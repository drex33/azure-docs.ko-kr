---
title: '자습서: NAT 게이트웨이를 공용 부하 분산 장치와 통합 - Azure Portal'
titleSuffix: Virtual Network NAT
description: 이 자습서에서는 Azure Portal을 사용하여 Virtual Network NAT 게이트웨이를 공용 부하 분산 장치와 통합하는 방법에 대해 알아봅니다.
author: asudbring
ms.author: allensu
ms.service: virtual-network
ms.subservice: nat
ms.topic: tutorial
ms.date: 03/19/2021
ms.custom: template-tutorial
ms.openlocfilehash: ffc5b04928842b940a369ef00807bf0a2e1b0230
ms.sourcegitcommit: 692382974e1ac868a2672b67af2d33e593c91d60
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/22/2021
ms.locfileid: "130249023"
---
# <a name="tutorial-integrate-a-nat-gateway-with-a-public-load-balancer-using-the-azure-portal"></a>자습서: Azure Portal을 사용하여 NAT 게이트웨이를 공용 부하 분산 장치와 통합

이 자습서에서는 NAT 게이트웨이를 공용 부하 분산 장치와 통합하는 방법에 대해 알아봅니다.

기본적으로 Azure 표준 Load Balancer는 안전합니다. SNAT(원본 네트워크 주소 변환)를 활성화하여 아웃바운드 연결을 명시적으로 정의합니다. SNAT는 부하 분산 규칙 또는 아웃바운드 규칙에서 활성화됩니다. 

NAT 게이트웨이 통합은 백 엔드 풀 아웃바운드 SNAT에 대한 아웃바운드 규칙의 필요성을 대체합니다. 

이 자습서에서는 다음과 같은 작업을 수행하는 방법을 살펴봅니다.

> [!div class="checklist"]
> * Azure Load Balancer 만들기
> * Azure Load Balancer의 백 엔드 풀에 사용할 두 개의 가상 머신을 만듭니다.
> * NAT 게이트웨이 만들기
> * 부하 분산 장치 백 엔드 풀에 있는 가상 머신의 아웃바운드 연결의 유효성을 검사합니다.

## <a name="prerequisites"></a>필수 구성 요소

활성 구독이 있는 Azure 계정. [체험 계정을 만듭니다](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

## <a name="create-the-virtual-network"></a>가상 네트워크 만들기

이 섹션에서는 가상 네트워크 및 서브넷을 만듭니다.

1. 포털 맨 위에 있는 검색 상자에 **가상 네트워크** 를 입력합니다. 검색 결과에서 **가상 네트워크** 를 선택합니다.

2. **가상 네트워크** 에서 **+ 만들기** 를 선택합니다.

3. **가상 네트워크 만들기** 의 **기본** 탭에서 다음 정보를 입력하거나 선택합니다.

    | **설정**          | **값**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **프로젝트 세부 정보**  |                                                                 |
    | 구독     | Azure 구독 선택                                  |
    | 리소스 그룹   | **새로 만들기** 를 선택합니다. </br> **이름** 에 **TutoPubLBNAT-rg** 를 입력합니다. </br> **확인** 을 선택합니다. |
    | **인스턴스 세부 정보** |                                                                 |
    | 속성             | **myVNet** 입력                                    |
    | 지역           | **(미국) 미국 동부** 를 선택합니다. |

4. **IP 주소** 탭을 선택하거나 페이지 하단의 **다음: IP 주소** 단추를 선택합니다.

5. **IP 주소** 탭에서 다음 정보를 입력합니다.

    | 설정            | 값                      |
    |--------------------|----------------------------|
    | IPv4 주소 공간 | **10.1.0.0/16** 입력 |

6. **서브넷 이름** 아래에서 **기본값** 이라는 단어를 선택합니다.

7. **서브넷 편집** 에서 다음 정보를 입력합니다.

    | 설정            | 값                      |
    |--------------------|----------------------------|
    | 서브넷 이름 | **myBackendSubnet** 입력 |
    | 서브넷 주소 범위 | **10.1.0.0/24** 입력 |

8. **저장** 을 선택합니다.

9. **보안** 탭을 선택합니다.

10. **BastionHost** 에서 **사용** 을 선택합니다. 다음 정보를 입력합니다.

    | 설정            | 값                      |
    |--------------------|----------------------------|
    | Bastion 이름 | **myBastionHost** 입력 |
    | AzureBastionSubnet 주소 공간 | **10.1.1.0/27** 입력 |
    | 공용 IP 주소 | **새로 만들기** 를 선택합니다. </br> **이름** 에 대해 **myBastionIP** 를 입력합니다. </br> **확인** 을 선택합니다. |


11. **검토 + 만들기** 탭을 선택하거나 **검토 + 만들기** 단추를 선택합니다.

12. **만들기** 를 선택합니다.

## <a name="create-load-balancer"></a>부하 분산 장치 만들기

이 섹션에서는 가상 머신의 부하를 분산하는 영역 중복 부하 분산 장치를 만듭니다. 영역 중복에서 하나 이상의 가용성 영역이 실패할 수 있고 지역에서 한 영역이 정상으로 유지되는 한 데이터 경로는 유효합니다.

부하 분산 장치를 만드는 동안 다음을 구성합니다.

* 프런트 엔드 IP 주소
* 백 엔드 풀
* 인바운드 부하 분산 규칙

1. 포털 맨 위에 있는 검색 상자에 **부하 분산 장치** 를 입력합니다. 검색 결과에서 **부하 분산 장치** 를 선택합니다.

2. **부하 분산 장치** 페이지에서 **만들기** 를 선택합니다.

3. **부하 분산 장치 만들기** 페이지의 **기본 사항** 탭에서 다음 정보를 입력하거나 선택합니다. 

    | 설정                 | 값                                              |
    | ---                     | ---                                                |
    | **프로젝트 세부 정보** |   |
    | Subscription               | 구독을 선택합니다.    |    
    | Resource group         | **TutorPubLBNAT-rg** 를 선택합니다. |
    | **인스턴스 세부 정보** |   |
    | 이름                   | **myLoadBalancer** 를 입력합니다.                                   |
    | 지역         | **(미국) 미국 동부** 를 선택합니다.                                        |
    | Type          | **공용** 을 선택합니다.                                        |
    | SKU           | 기본값인 **표준** 을 그대로 둡니다. |
    | 계층          | 기본 **지역** 을 그대로 둡니다. |


4. 페이지 하단에서 **다음: 프런트 엔드 IP 구성** 을 선택합니다.

5. **프런트 엔드 IP 구성** 에서 **+ 프런트 엔드 IP 추가** 를 선택합니다.

6. **이름** 에 **LoadBalancerFrontend** 를 입력합니다.

7. **IP 버전** 에 대해 **IPv4** 또는 **IPv6** 를 선택합니다.

    > [!NOTE]
    > IPv6는 현재 라우팅 기본 설정 또는 지역 간 부하 분산(글로벌 계층)에서 지원되지 않습니다.

8. **IP 형식** 으로 **IP 주소** 를 선택합니다.

    > [!NOTE]
    > IP 접두사에 대한 자세한 내용은 [Azure 공용 IP 주소 접두사](../ip-services/public-ip-address-prefix.md)를 참조하세요.

9. **공용 IP 주소** 에서 **새로 만들기** 를 선택합니다.

10. **공용 IP 주소 추가** 에서 **이름** 에 **myPublicIP** 를 입력합니다.

11. **가용성 영역** 에서 **영역 중복** 을 선택합니다.

    > [!NOTE]
    > [가용성 영역](../../availability-zones/az-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json#availability-zones)이 있는 지역에서는 영역 없음(기본 옵션), 특정 영역 또는 영역 중복을 선택하는 옵션이 있습니다. 선택은 특정 도메인 오류 요구 사항에 따라 달라집니다. 가용성 영역이 없는 지역에서는 이 필드가 표시되지 않습니다. </br> 가용성 영역에 대한 자세한 내용은 [가용성 영역 개요](../../availability-zones/az-overview.md)를 참조하세요.

12. **라우팅 기본 설정** 에는 **Microsoft 네트워크** 의 기본값을 그대로 둡니다.

13. **확인** 을 선택합니다.

14. **추가** 를 선택합니다.

15. 페이지 하단에서 **다음: 백 엔드 풀** 을 선택합니다.

16. **백 엔드 풀** 탭에서 **+ 백 엔드 풀 추가** 를 선택합니다.

17. **백 엔드 풀 추가** 의 **이름** 에 **myBackendPool** 을 입력합니다.

18. **가상 네트워크** 에서 **myVNet** 을 선택합니다.

19. **백 엔드 풀 구성** 에 **NIC** 또는 **IP 주소** 를 선택합니다.

20. **IP 버전** 에 대해 **IPv4** 또는 **IPv6** 를 선택합니다.

21. **추가** 를 선택합니다.

22. 페이지 하단에 있는 **다음: 인바운드 규칙** 단추를 선택합니다.

23. **인바운드 규칙** 탭의 **부하 분산 규칙** 에서 **+ 부하 분산 규칙 추가** 를 선택합니다.

24. **부하 분산 규칙 추가** 에서 다음 정보를 입력하거나 선택합니다.

    | 설정 | 값 |
    | ------- | ----- |
    | Name | **myHTTPRule** 입력 |
    | IP 버전 | 요구 사항에 따라 **IPv4** 또는 **IPv6** 를 선택합니다. |
    | 프런트 엔드 IP 주소 | **LoadBalancerFrontend** 를 선택합니다. |
    | 프로토콜 | **TCP** 를 선택합니다. |
    | 포트 | **80** 을 입력합니다. |
    | 백 엔드 포트 | **80** 을 입력합니다. |
    | 백 엔드 풀 | **myBackendPool** 을 선택합니다. |
    | 상태 프로브 | **새로 만들기** 를 선택합니다. </br> **이름** 에 **myHealthProbe** 를 입력합니다. </br> **프로토콜** 에서 **HTTP** 를 선택합니다. </br> 나머지는 기본값으로 두고 **확인** 을 선택합니다. |
    | 세션 지속성 | **없음** 을 선택합니다. |
    | 유휴 제한 시간(분) | **15** 를 입력하거나 선택합니다. |
    | TCP 재설정 | **사용** 을 선택합니다. |
    | 부동 IP | **사용 안 함** 을 선택합니다. |
    | 아웃바운드 SNAT(Source Network Address Translation) | **(권장) 아웃바운드 규칙을 사용하여 백 엔드 풀 멤버에 인터넷 액세스 권한을 제공합니다.** (기본값)를 그대로 둡니다. |

25. **추가** 를 선택합니다.

26. 페이지 하단에 있는 파란색 **검토 + 만들기** 단추를 선택합니다.

27. **만들기** 를 선택합니다.

## <a name="create-virtual-machines"></a>가상 머신 만들기

이 섹션에서는 두 개의 다른 영역(**영역 1** 및 **영역 2**)에서 두 개의 VM(**myVM1** 및 **myVM2**)을 만듭니다.

이러한 VM은 이전에 만든 부하 분산 장치의 백 엔드 풀에 추가됩니다.

1. 포털의 왼쪽 위에서 **리소스 만들기** > **컴퓨팅** > **가상 머신** 을 차례로 선택합니다. 
   
2. **가상 머신 만들기** 의 **기본** 탭에서 값을 입력하거나 선택합니다.

    | 설정 | 값                                          |
    |-----------------------|----------------------------------|
    | **프로젝트 세부 정보** |  |
    | 구독 | Azure 구독 선택 |
    | 리소스 그룹 | **TutorPubLBNAT-rg** 를 선택합니다. |
    | **인스턴스 세부 정보** |  |
    | 가상 머신 이름 | **myVM1** 을 입력합니다. |
    | 지역 | **(미국) 미국 동부** 를 선택합니다. |
    | 가용성 옵션 | **가용성 영역** 을 선택합니다. |
    | 가용성 영역 | **1** 을 선택합니다. |
    | 이미지 | **Windows Server 2019 Datacenter** 를 선택합니다. |
    | Azure Spot 인스턴스 | 기본값을 그대로 둡니다. |
    | 크기 | VM 크기를 선택하거나 기본 설정을 사용합니다. |
    | **관리자 계정** |  |
    | 사용자 이름 | 사용자 이름을 입력합니다. |
    | 암호 | 암호를 입력합니다. |
    | 암호 확인 | 암호를 다시 입력합니다. |
    | **인바운드 포트 규칙** |  |
    | 공용 인바운드 포트 | **없음** 을 선택합니다. |

3. **네트워킹** 탭을 선택하거나 **다음: 디스크**, **다음: 네트워킹** 을 차례로 선택합니다.
  
4. [네트워킹] 탭에서 다음을 선택하거나 입력합니다.

    | 설정 | 값 |
    |-|-|
    | **네트워크 인터페이스** |  |
    | 가상 네트워크 | **myVNet** |
    | 서브넷 | **myBackendSubnet** |
    | 공용 IP | **없음** 을 선택합니다. |
    | NIC 네트워크 보안 그룹 추가 | **고급** 을 선택합니다.|
    | 네트워크 보안 그룹 구성 | **새로 만들기** 를 선택합니다. </br> **네트워크 보안 그룹 만들기** 의 **이름** 에서 **myNSG** 를 입력합니다. </br> **인바운드 규칙** 아래에서 **+ 인바운드 규칙 추가** 를 선택합니다. </br> **대상 포트 범위** 에서 **80** 을 입력합니다. </br> **우선 순위** 아래에서 **100** 을 입력합니다. </br> **이름** 에 **myNSGRule** 을 입력합니다. </br> **추가** 를 선택합니다. </br> **확인** 을 선택합니다. |
    | **부하 분산**.  |
    | 기존 부하 분산 솔루션 뒤에 이 가상 머신을 배치하시겠습니까? | 확인란을 선택합니다.|
    | **부하 분산 설정** |
    | 부하 분산 옵션 | **Azure 부하 분산 장치** 선택 |
    | 부하 분산 장치 선택 | **myLoadBalancer** 를 선택합니다.  |
    | 백 엔드 풀 선택 | **myBackendPool** 을 선택합니다. |
   
5. **검토 + 만들기** 를 선택합니다. 
  
6. 설정을 검토한 다음, **만들기** 를 선택합니다.

7. 1~7단계에 따라 다음 값 및 **myVM1** 과 동일한 다른 모든 설정을 사용하여 VM을 만듭니다.

    | 설정 | VM 2 |
    | ------- | ----- |
    | Name |  **myVM2** |
    | 가용성 영역 | **2** |
    | 네트워크 보안 그룹 | 기존 **myNSG** 를 선택합니다. | 

## <a name="create-nat-gateway"></a>NAT 게이트웨이 만들기

이 섹션에서는 NAT 게이트웨이를 만들고 이전에 만든 가상 네트워크의 서브넷에 할당합니다.

1. 화면의 왼쪽 위에서 **리소스 만들기 > 네트워킹 > NAT 게이트웨이** 를 차례로 선택하거나 검색 상자에서 **NAT 게이트웨이** 를 검색합니다.

2. **만들기** 를 선택합니다. 

3. **NAT(Network Address Translation) 게이트웨이 만들기** 의 **기본 사항** 탭에서 다음 정보를 입력하거나 선택합니다.

    | **설정**          | **값**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **프로젝트 세부 정보**  |                                                                 |
    | Subscription     | Azure 구독을 선택합니다.                                  |
    | 리소스 그룹   | **TutorPubLBNAT-rg** 를 선택합니다. |
    | **인스턴스 세부 정보** |                                                                 |
    | 이름             | **myNATGateway** 선택                                    |
    | 지역           | **(미국) 미국 동부** 를 선택합니다.  |
    | 가용성 영역 | **없음** 을 선택합니다. |
    | 유휴 제한 시간(분) | **10** 을 입력합니다. |

4. **아웃바운드 IP** 탭을 선택하거나 페이지 하단에 있는 **다음: 아웃바운드 IP** 단추를 선택합니다.

5. **아웃바운드 IP** 탭에서 다음 정보를 입력하거나 선택합니다.

    | **설정** | **값** |
    | ----------- | --------- |
    | 퍼블릿 IP 주소 | **새 공용 IP 주소 만들기** 를 선택합니다. </br> **이름** 에 **myNATgatewayIP** 를 입력합니다. </br> **확인** 을 선택합니다. |

6. **서브넷** 탭을 선택하거나 페이지 하단에 있는 **다음: 서브넷** 단추를 선택합니다.

7. **서브넷** 탭의 **가상 네트워크** 풀다운에서 **myVNet** 을 선택합니다.

8. **myBackendSubnet** 옆의 상자를 선택합니다.

9. **검토 + 만들기** 탭을 선택하거나 페이지 하단에 있는 파란색 **검토 + 만들기** 단추를 선택합니다.

10. **만들기** 를 선택합니다.

## <a name="test-nat-gateway"></a>NAT 게이트웨이 테스트

이 섹션에서는 NAT 게이트웨이를 테스트합니다. 먼저 NAT 게이트웨이의 공용 IP를 검색합니다. 그런 다음, 테스트 가상 머신에 연결하고 NAT 게이트웨이를 통해 아웃바운드 연결을 확인합니다.
    
1. **개요** 화면에서 NAT 게이트웨이에 대한 공용 IP 주소를 찾습니다. 왼쪽 메뉴에서 **모든 서비스** 를 선택하고 **모든 리소스** 를 선택한 다음, **myPublicIP** 를 선택합니다.

2. 공용 IP 주소를 기록해 둡니다.

    :::image type="content" source="./media/tutorial-nat-gateway-load-balancer-public-portal/find-public-ip.png" alt-text="NAT 게이트웨이의 공용 IP 주소 검색 스크린샷." border="true":::

3. 왼쪽 메뉴에서 **모든 서비스** 를 선택하고 **모든 리소스** 를 선택한 다음, 리소스 목록에서 **TutorPubLBNAT-rg** 리소스 그룹에 있는 **myVM1** 을 선택합니다.

4. **개요** 페이지에서 **연결** 을 선택한 다음, **Bastion** 을 선택합니다.

5. 파란색 **Bastion 사용** 단추를 선택합니다.

6. VM을 만드는 동안 입력한 사용자 이름과 암호를 입력합니다.

7. **myVM1** 에서 **Internet Explorer** 를 엽니다.

8. 주소 표시줄에 **https://whatsmyip.com** 을 입력합니다.

9. 표시된 IP 주소가 이전 단계에서 적어둔 NAT 게이트웨이 주소와 일치하는지 확인합니다.

    :::image type="content" source="./media/tutorial-nat-gateway-load-balancer-public-portal/my-ip.png" alt-text="외부 아웃바운드 IP를 표시하는 Internet Explorer 스크린샷." border="true":::

## <a name="clean-up-resources"></a>리소스 정리

이 애플리케이션을 계속 사용하지 않으려면 다음 단계에 따라 가상 네트워크, 가상 머신 및 NAT 게이트웨이를 삭제합니다.

1. 왼쪽 메뉴에서 **리소스 그룹** 을 선택합니다.

2. **TutorPubLBNAT-rg** 리소스 그룹을 선택합니다.

3. **리소스 그룹 삭제** 를 선택합니다.

4. **TutorPubLBNAT-rg** 를 입력하고 **삭제** 를 선택합니다.

## <a name="next-steps"></a>다음 단계

Azure Virtual Network NAT에 대한 자세한 내용은 다음을 참조하세요.
> [!div class="nextstepaction"]
> [Virtual Network NAT 개요](nat-overview.md)