---
title: Azure 파일 동기화 클라우드 계층화 정책 선택 | Microsoft Docs
description: Azure 파일 동기화 클라우드 계층화 정책을 선택할 때 염두에 두어야 할 사항에 대한 세부 정보입니다.
author: roygara
ms.service: storage
ms.topic: conceptual
ms.date: 04/13/2021
ms.author: rogarana
ms.subservice: files
ms.openlocfilehash: 40715f8076ac112ea6479fb4a134933d90b3dbf9
ms.sourcegitcommit: 2eac9bd319fb8b3a1080518c73ee337123286fa2
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/31/2021
ms.locfileid: "123252274"
---
# <a name="choose-cloud-tiering-policies"></a>클라우드 계층화 정책 선택

이 문서에서는 클라우드 계층화 정책을 선택하고 조정하는 사용자를 위한 지침을 제공합니다. 이 문서를 검토하기 전에 클라우드 계층화의 작동 방식을 이해해야 합니다. 클라우드 계층화 기본 사항은 [Azure 파일 동기화 클라우드 계층화 이해](file-sync-cloud-tiering-overview.md)를 참조하세요. 예제를 사용한 클라우드 계층화 정책에 대한 자세한 설명은 [Azure 파일 동기화 클라우드 계층화 정책](file-sync-cloud-tiering-policy.md)을 참조하세요.

## <a name="limitations"></a>제한 사항
- 클라우드 계층화는 Windows 시스템 볼륨에서 지원되지 않습니다.

- 볼륨 수준 FSRM 할당량이 있는 경우 클라우드 계층화를 사용하도록 설정할 수 있습니다. FSRM 할당량이 설정되면 자동으로 호출되는 사용 가능한 공간 쿼리 API는 할당량 설정에 따라 볼륨에서 사용 가능한 공간을 보고합니다. 

### <a name="minimum-file-size-for-a-file-to-tier"></a>계층화할 파일의 최소 파일 크기

에이전트 버전 9 이상에서 계층화할 파일의 최소 파일 크기는 파일 시스템 클러스터 크기에 따라 다릅니다. 클라우드 계층화에 적합한 최소 파일 크기는 클러스터 크기의 2배로 계산되며, 최소 8KiB입니다. 다음 표에서는 볼륨 클러스터 크기를 기반으로 계층화할 수 있는 최소 파일 크기를 보여 줍니다.

|볼륨 클러스터 크기  |계층화할 수 있는 최소 파일 크기  |
|----------------------------|---------|
|4KiB 이하(4096바이트)      | 8KiB    |
|8KiB(8192바이트)                 | 16KiB   |
|16KiB(16384바이트)               | 32KiB   |
|32KiB(32768바이트)               | 64KiB   |
|64KiB(65536바이트)    | 128KiB  |
|128KiB(131072바이트) | 256KiB |
|256KiB(262144바이트) | 512KiB |
|512KiB(524288바이트) | 1MiB |
|1MiB(1048576바이트) | 2MiB |
|2MiB(2097152바이트) | 4MiB |

최대 2MiB의 클러스터 크기는 Azure 파일 동기화 에이전트 버전 12에서 지원되지만, 크기가 더 큰 경우 클라우드 계층화가 작동하지 않습니다.

Windows에서 사용하는 모든 파일 시스템은 클러스터 크기(할당 단위 크기라고도 함)에 따라 하드 디스크를 구성합니다. 클러스터 크기는 파일을 보관하는데 사용할 수 있는 최소 크기의 디스크 공간을 나타냅니다. 파일 크기가 클러스터 크기의 짝수 배수가 아닌 경우 파일을 보관하기 위해 클러스터 크기의 다음 배수까지 추가 공간을 사용해야 합니다.

Azure 파일 동기화는 Windows Server 2012 R2 이상 버전의 NTFS 볼륨에서 지원됩니다. 다음 표에서는 Windows Server 2019에서 새 NTFS 볼륨을 만들 때의 기본 클러스터 크기에 대해 설명합니다.

|볼륨 크기    |Windows Server 2019             |
|---------------|--------------------------------|
|7MiB ~ 16TiB   | 4KiB                |
|16TiB ~ 32TiB   | 8KiB                |
|32TiB ~ 64TiB   | 16KiB               |

볼륨을 만들 때 다른 클러스터 크기로 볼륨을 수동으로 포맷했을 수 있습니다. 이전 버전의 Windows에서 볼륨을 만든 경우 기본 클러스터 크기가 다를 수도 있습니다. [이 문서에서는 기본 클러스터 크기에 대한 자세한 정보를 제공합니다.](https://support.microsoft.com/help/140365/default-cluster-size-for-ntfs-fat-and-exfat) 4KiB보다 작은 클러스터 크기를 선택하는 경우에도 계층화할 수 있는 최소 파일 크기에 8KiB 한도가 계속 적용됩니다. 기술적으로 클러스터 크기의 2배가 8KiB보다 작은 경우에도 마찬가지입니다.

절대적인 최솟값을 유지하는 이유는 NTFS가 매우 작은 파일(1KiB~4KiB 크기의 파일)을 저장하는 방법 때문입니다. 볼륨의 다른 매개 변수에 따라 작은 파일이 디스크의 클러스터에 저장되지 않을 수 있습니다. 이러한 파일은 볼륨의 마스터 파일 테이블 또는 “MFT 레코드”에 직접 저장하는 것이 더 효율적일 수 있습니다. 클라우드 계층화 재분석 지점은 항상 디스크에 저장되고 정확히 하나의 클러스터를 사용합니다. 이렇게 작은 파일을 계층화하면 공간이 절약되지 않을 수 있습니다. 극단적인 경우에는 클라우드 계층화 사용으로 더 많은 공간이 사용될 수도 있습니다. 이런 경우로부터 보호하기 위해 클라우드 계층화에서 계층화할 최소 파일 크기는 4KiB보다 작은 클러스터 크기에서도 8KiB입니다. 

## <a name="selecting-your-initial-policies"></a>초기 정책 선택

일반적으로 서버 엔드포인트에서 클라우드 계층화를 사용하도록 설정할 때 각 개별 서버 엔드포인트에 대해 하나의 로컬 가상 드라이브를 만들어야 합니다. 서버 엔드포인트를 격리하면 클라우드 계층화의 작동 방식을 이해하고 그에 따라 정책을 조정하기가 더 쉽습니다. 그러나 Azure 파일 동기화는 여러 서버 엔드포인트가 동일한 드라이브에 있는 경우에도 작동합니다. 자세한 내용은 [로컬 볼륨의 여러 서버 엔드포인트](file-sync-cloud-tiering-policy.md#multiple-server-endpoints-on-a-local-volume) 섹션을 참조하세요. 또한 처음으로 클라우드 계층화를 사용하도록 설정할 때 날짜 정책은 사용하지 않도록 유지하고 사용 가능한 볼륨 공간 정책은 10%에서 20% 정도로 유지하는 것이 좋습니다. 대부분의 파일 서버 볼륨에서 20%의 사용 가능한 볼륨 공간이 일반적으로 가장 적합합니다.

간단하게 나타내고 항목이 계층화되는 방식을 명확하게 이해하려면 주로 사용 가능한 볼륨 공간 정책을 조정하고 필요한 경우가 아니라면 날짜 정책은 사용 안 함 상태로 유지하는 것이 좋습니다. 대부분의 고객이 최대한 많은 핫 파일로 로컬 캐시를 채우고 나머지를 클라우드로 계층화하는 것이 중요하다고 생각하기 때문에 이 방법을 사용하는 것이 좋습니다. 그러나 로컬 디스크 공간을 사전에 확보하려고 하고 날짜 정책에 지정된 기간(일수) 이후에 액세스한 해당 서버 엔드포인트의 파일은 로컬에 유지할 필요가 없는 경우에는 날짜 정책이 유용할 수 있습니다. 날짜 정책을 설정하면 동일한 볼륨의 다른 엔드포인트에 대해 중요한 로컬 디스크 용량을 확보하여 더 많은 파일을 캐시할 수 있습니다.

정책을 설정한 후에는 송신을 모니터링하고 그에 따라 두 정책을 조정합니다. 특히 Azure Monitor에서 **클라우드 계층화 회수 크기** 및 **애플리케이션별 클라우드 계층화 회수 크기** 메트릭을 확인하는 것이 좋습니다. 송신 모니터링 방법을 알아보려면 [클라우드 계층화 모니터링](file-sync-monitor-cloud-tiering.md)을 참조하세요.

## <a name="adjusting-your-policies"></a>정책 조정

Azure에서 지속적으로 회수되는 파일의 양이 원하는 것보다 큰 경우 로컬 서버 볼륨에 저장할 수 있는 공간보다 더 많은 핫 파일이 있을 수 있습니다. 가능하면 로컬 볼륨 크기를 늘리고 사용 가능한 볼륨 공간 정책 백분율을 조금씩 줄입니다. 사용 가능한 볼륨 공간 백분율을 너무 많이 줄이면 부정적인 결과가 발생할 수도 있습니다. 데이터 세트의 변동률이 높을수록 새 파일 및 “콜드” 파일의 회수에 사용 가능한 공간이 더 많이 필요합니다. 계층화는 최대 1시간 지연된 후 시작되므로 처리 시간이 필요합니다. 따라서 볼륨에 사용 가능한 공간이 항상 충분히 있어야 합니다.

더 많은 데이터를 로컬에 유지하면 Azure에서 회수되는 파일 수가 감소하여 송신 비용이 줄어듭니다. 하지만 그와 동시에 더 큰 온-프레미스 스토리지가 필요하므로 스토리지 비용이 발생합니다. 

사용 가능한 볼륨 공간 정책을 조정할 때 로컬에 유지해야 하는 데이터의 양은 대역폭, 데이터 세트의 액세스 패턴, 예산과 같은 요인에 따라 결정됩니다. 낮은 대역폭 연결을 사용하면 사용자에게 최소한의 지연 시간을 보장하기 위해 더 많은 로컬 데이터가 필요할 수 있습니다. 그렇지 않은 경우에는 지정된 기간 동안의 변동률에 따라 보관할 데이터의 양을 결정할 수 있습니다. 예를 들어, 매월 1TiB 데이터 세트 중 10%를 변경하거나 실제로 액세스하는 경우에는 파일을 자주 회수하지 않아도 되도록 100GiB의 데이터를 로컬에 보관할 수 있습니다. 볼륨 크기가 2TiB라면 5%(또는 100GiB)를 로컬에 보관할 수 있습니다. 이 경우 나머지 95%가 사용 가능한 볼륨 공간 백분율입니다. 그러나 변동률이 높은 기간에는 버퍼를 추가해야 합니다. 즉, 사용 가능한 볼륨 공간 백분율을 높게 설정했다가 나중에 필요하면 조정하는 것이 좋습니다.

## <a name="standard-operating-procedures"></a>표준 운영 절차

- Azure 파일 동기화를 통해 Azure Files로 처음 마이그레이션하는 경우 클라우드 계층화는 초기 업로드에 종속됩니다.
- 클라우드 계층화는 60분마다 사용 가능한 볼륨 공간 및 날짜 정책 준수를 확인합니다.
- 파일을 마이그레이션할 때 Robocopy에서 /LFSM 스위치를 사용하면 파일을 동기화할 수 있으며 클라우드 계층화에서 초기 업로드 중에 공간을 만들 수 있습니다. 
- 열 지도가 형성되기 전에 계층화가 발생하면 파일이 마지막으로 수정한 타임스탬프로 계층화됩니다.

## <a name="next-steps"></a>다음 단계

* [Azure 파일 동기화 배포에 대한 계획](file-sync-planning.md)
