---
title: Azure Functions의 동시성
description: Azure Functions의 동적 동시성 기능에 대 한 개요입니다.
author: cachai2
ms.topic: conceptual
ms.date: 9/24/2021
ms.author: cachai
ms.openlocfilehash: 21702bf5bdc8eeee014305c106006a18640c001f
ms.sourcegitcommit: 8946cfadd89ce8830ebfe358145fd37c0dc4d10e
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 11/05/2021
ms.locfileid: "131847663"
---
# <a name="concurrency-in-azure-functions"></a>Azure Functions의 동시성

이 문서에서는 Azure Functions 이벤트 기반 트리거의 동시성 동작을 설명 합니다. 또한 동시성 동작을 최적화 하기 위한 새로운 동적 모델을 설명 합니다. 

>[!NOTE]
>동적 동시성 모델은 현재 미리 보기로 제공 됩니다. 동적 동시성 지원은 특정 바인딩 확장으로 제한 됩니다.

함수에 대 한 호스팅 모델을 통해 단일 계산 인스턴스에서 여러 함수 호출을 동시에 실행할 수 있습니다. 예를 들어 함수 앱에 세 개의 함수를 포함 하는 경우 여러 인스턴스에서 크기를 확장 하 고 실행 하는 경우를 가정해 보겠습니다. 이 시나리오에서 각 함수는 함수 앱이 실행 되는 각 VM 인스턴스에 대 한 호출을 처리 합니다. 단일 인스턴스에 대 한 함수 호출은 메모리, CPU 및 연결과 같은 동일한 VM 계산 리소스를 공유 합니다. 앱이 동적 계획 (소비 또는 Premium)에서 호스트 되는 경우 플랫폼은 들어오는 이벤트의 수에 따라 함수 앱 인스턴스 수를 확장 하거나 축소 합니다. 자세히 알아보려면 [이벤트 기반 크기 조정](./Event-Driven-Scaling.md)을 참조 하세요. 전용 (App Service) 계획에서 함수를 호스트 하는 경우 수동으로 인스턴스를 구성 하거나 [자동 크기 조정 체계를 설정](dedicated-plan.md#scaling)합니다.

여러 함수 호출을 각 인스턴스에서 동시에 실행할 수 있으므로 각 함수에는 지정 된 시간에 처리 중인 동시 호출 수를 제한 하는 방법이 있어야 합니다.

## <a name="static-concurrency"></a>정적 동시성

대부분의 트리거는 해당 트리거 형식에 대해 인스턴스별 동시성을 지정 하는 데 사용 되는 호스트 수준 정적 구성 모델을 지원 합니다. 예를 들어 [Service Bus 트리거](./functions-bindings-service-bus-trigger.md) 는 `MaxConcurrentCalls` `MaxConcurrentSessions` [호스트 json 파일](functions-host-json.md)의 및 설정을 모두 제공 합니다. 이러한 설정은 각 함수가 각 인스턴스에서 동시에 처리 하는 최대 메시지 수를 제어 합니다. 다른 트리거 형식에는 인스턴스 간 부하 분산 호출을 위한 기본 제공 메커니즘이 있습니다. 예를 들어 Event Hubs 및 Azure Cosmos DB는 모두 파티션 기반 체계를 사용 합니다. 

동시성 구성을 지 원하는 트리거 형식의 경우 함수 앱에 대 한 호스트. json 파일에서 재정의 하도록 선택할 수 있는 기본 동작이 있습니다. 실행 중인 모든 인스턴스에 적용 되는 이러한 설정을 사용 하면 각 인스턴스에서 함수의 최대 동시성을 제어할 수 있습니다. 예를 들어 함수가 CPU 또는 리소스를 많이 사용 하는 경우 인스턴스를 정상 상태로 유지 하도록 동시성을 제한 하도록 선택할 수 있습니다. 마찬가지로 함수에서 제한 중인 다운스트림 서비스에 대 한 요청을 수행 하는 경우 동시성을 제한 하는 것도 고려해 야 합니다. 

이러한 동시성 구성은 함수 제한과 같은 특정 트리거 동작에 대 한 제어를 제공 하지만 이러한 설정에 대 한 최적의 값을 결정 하기 어려울 수 있습니다. 일반적으로 부하 테스트의 평가 및 오류 프로세스를 통해 허용 가능한 값에 도달 해야 합니다. 특정 부하 프로필에 대해 작동 하는 값 집합을 결정 하는 경우에도 연결 된 서비스에서 도착 하는 이벤트 수가 매일 변경 될 수 있습니다. 이러한 산포도는 앱이 최적이 아닌 값으로 실행 될 수 있음을 의미 합니다. 예를 들어 함수 앱은 주의 마지막 날에 특히 까다로운 메시지 페이로드를 처리할 수 있으므로 동시성을 제한 해야 합니다. 그러나 나머지 주에는 메시지 페이로드가 더 간단 합니다. 즉, 나머지 주를 더 높은 동시성 수준으로 사용할 수 있습니다. 

이상적으로는 각 인스턴스를 정상 상태로 유지 하 고 대기 시간을 낮게 유지 하는 동시에 동적 동시성을 설계 하는 것과 같이 인스턴스가 최대한 많은 작업을 처리할 수 있도록 해야 합니다.

## <a name="dynamic-concurrency-preview"></a>동적 동시성 (미리 보기)

이제 함수는 동일한 계획에서 실행 되는 모든 함수 앱에 대해 동시성 구성을 간소화 하는 동적 동시성 모델을 제공 합니다. 

> [!NOTE]
> 동적 동시성은 현재 azure Blob, azure Queue 및 Service Bus 트리거에 대해서만 지원 되며 [아래 확장 지원 섹션](#extension-support)에 나열 된 버전을 사용 해야 합니다.

### <a name="benefits"></a>이점

동적 동시성을 사용 하면 다음과 같은 이점이 있습니다. 

- **단순화 된 구성**: 더 이상 트리거 별 동시성 설정을 수동으로 확인할 필요가 없습니다. 시스템은 시간이 지남에 따라 작업의 최적 값을 학습 합니다. 
- **동적 조정**: 동시성은 실시간으로 동적으로 조정 되며 시스템이 시간이 지남에 따라 변경 된 부하 패턴에 맞게 조정 될 수 있도록 합니다. 
- **인스턴스 상태 보호**: 런타임은 함수 앱 인스턴스가 편안 하 게 처리할 수 있는 수준으로 동시성을 제한 합니다. 이렇게 하면 보다 많은 작업을 수행 하 여 앱을 오버 로드 하지 않도록 보호 합니다. 
- **향상 된 처리량**: 개별 인스턴스가 신속 하 게 처리할 수 있는 것 보다 더 많은 작업을 가져오지 않으므로 전체 처리량이 향상 됩니다. 이를 통해 작업은 인스턴스 간에 더 효과적으로 부하를 분산할 수 있습니다. 더 높은 부하를 처리할 수 있는 함수의 경우 동시성은 기본 구성 값을 초과 하는 값으로 증가 하 여 더 높은 처리량을 얻을 수 있습니다.

### <a name="dynamic-concurrency-configuration"></a>동적 동시성 구성

동적 동시성은 호스트 json 파일의 호스트 수준에서 사용 하도록 설정할 수 있습니다. 로 설정 된 경우 동적 동시성을 지 원하는 함수 앱에서 사용 하는 모든 바인딩 확장은 필요에 따라 동시성을 동적으로 조정 합니다. 동적 동시성 설정은 동적 동시성을 지 원하는 트리거에 대해 수동으로 구성 된 동시성 설정을 재정의 합니다. 

동적 동시성은 기본적으로 사용 되지 않습니다. 동적 동시성을 사용 하는 경우 동시성은 각 함수에 대해 1에서 시작 하 고, 호스트에 의해 결정 되는 최적 값으로 조정 됩니다.

호스트 json 파일에 다음 설정을 추가 하 여 함수 앱에서 동적 동시성을 사용 하도록 설정할 수 있습니다. 

```json
    { 
        "version": "2.0", 
        "concurrency": { 
            "dynamicConcurrencyEnabled": true, 
            "snapshotPersistenceEnabled": true 
        } 
    } 
```

 `SnapshotPersistenceEnabled`가 기본값인 인 경우 `true` 학습 된 동시성 값은 주기적으로 저장소에 저장 되므로 새 인스턴스는 1부터 시작 하 여 학습을 다시 실행 하는 대신 해당 값에서 시작 됩니다. 

### <a name="concurrency-manager"></a>동시성 관리자 

백그라운드에서 동적 동시성을 사용 하는 경우 백그라운드에서 실행 되는 동시성 관리자 프로세스가 있습니다. 이 관리자는 CPU 및 스레드 사용률과 같은 인스턴스 상태 메트릭을 지속적으로 모니터링 하 고 필요에 따라 제한를 변경 합니다. 하나 이상의 제한를 사용 하도록 설정 하면 호스트가 다시 정상 상태가 될 때까지 함수 동시성이 조정 됩니다. 제한를 사용 하지 않도록 설정 하면 동시성이 증가할 수 있습니다. 이러한 제한에 따라 필요에 따라 동시성을 지능적으로 조정 하는 데 다양 한 추론 방법이 사용 됩니다. 시간이 지남에 따라 각 함수에 대 한 동시성이 특정 수준으로 안정화 됩니다. 

동시성 수준은 각 개별 기능에 대해 관리 됩니다. 따라서 시스템은 낮은 수준의 동시성이 필요한 리소스 집약적 함수와 더 높은 동시성을 처리할 수 있는 더 간단한 함수 간에 균형을 조정 합니다. 각 함수에 대 한 동시성의 균형은 함수 앱 인스턴스의 전반적인 상태를 유지 하는 데 도움이 됩니다.  

동적 동시성을 사용 하는 경우 로그에 동적 동시성 결정이 표시 됩니다. 예를 들어 다양 한 제한를 사용 하는 경우와 각 함수에 대해 동시성이 조정 되거나 축소 될 때마다 로그가 표시 됩니다. 이러한 로그는 추적 테이블의 **호스트. 동시성** 로그 범주 아래에 기록 됩니다. 

### <a name="extension-support"></a>확장 지원 

동적 동시성은 호스트 수준에서 함수 앱에 대해 사용 하도록 설정 되며 동적 동시성을 지 원하는 모든 확장은 해당 모드에서 실행 됩니다. 동적 동시성에는 호스트와 개별 트리거 확장 간의 공동 작업이 필요 합니다. 미리 보기의 경우 다음 확장의 나열 된 버전만 동적 동시성을 지원 합니다.

#### <a name="azure-queues"></a>Azure 큐

Azure Queue storage 트리거에는 자체 메시지 폴링 루프가 있습니다. 정적 구성을 사용 하는 경우 동시성은 구성 옵션의 적용을 받습니다 `BatchSize` / `NewBatchThreshold` . 동적 동시성을 사용 하는 경우 해당 구성 값은 무시 됩니다. 동적 동시성은 메시지 루프에 통합 되므로 반복 당 인출 되는 메시지 수는 동적으로 조정 됩니다. 제한를 사용 하는 경우 (호스트가 오버 로드 됨) 제한를 사용 하지 않도록 설정할 때까지 메시지 처리가 일시 중지 됩니다. 제한를 사용 하지 않도록 설정 하면 동시성이 증가 합니다.

큐에 대해 동적 동시성을 사용 하려면 저장소 확장의 [버전](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.Storage) 5.x를 사용 해야 합니다.

#### <a name="azure-blobs"></a>Azure Blob

내부적으로 Azure Blob storage 트리거는 Azure Queue Trigger에서 사용 하는 것과 동일한 인프라를 사용 합니다. 새/업데이트 된 blob을 처리 해야 하는 경우 메시지는 플랫폼 관리 제어 큐에 기록 되 고 QueueTrigger에 사용 되는 것과 동일한 논리를 사용 하 여 해당 큐가 처리 됩니다. 동적 동시성을 사용 하는 경우 해당 제어 큐의 처리에 대 한 동시성이 동적으로 관리 됩니다.

Blob에 동적 동시성을 사용 하려면 저장소 확장의 [버전](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.Storage) 5.x를 사용 해야 합니다.


#### <a name="service-bus"></a>Service Bus 

Service Bus 트리거는 현재 3 개의 실행 모델을 지원 합니다. 동적 동시성은 다음과 같이 이러한 실행 모델에 영향을 줍니다.
 
- **단일 디스패치 토픽/큐 처리**: 함수를 호출할 때마다 단일 메시지를 처리 합니다. 정적 구성을 사용 하는 경우 동시성은 MaxConcurrentCalls config 옵션에 의해 제어 됩니다. 동적 동시성을 사용 하는 경우 해당 구성 값은 무시 되 고 동시성이 동적으로 조정 됩니다. 
- **세션 기반 단일 디스패치 토픽/큐 처리**: 각 함수 호출은 단일 메시지를 처리 합니다. 토픽/큐에 대 한 활성 세션 수에 따라 각 인스턴스는 하나 이상의 세션을 임대 합니다. 세션의 순서를 보장 하기 위해 각 세션의 메시지는 순차적으로 처리 됩니다. 동적 동시성을 사용 하지 않는 경우 동시성은 설정에 따라 결정 됩니다 `MaxConcurrentSessions` . 동적 동시성을 사용 하면 `MaxConcurrentSessions` 가 무시 되 고 각 인스턴스가 처리 하는 세션 수가 동적으로 조정 됩니다. 
- **일괄 처리**: 각 함수 호출은 설정에 따라 제어 되는 메시지 일괄 처리를 처리 `MaxMessageCount` 합니다. 일괄 처리 호출은 직렬 이므로 일괄 처리 트리거되는 함수에 대 한 동시성은 항상 하나 이며 동적 동시성은 적용 되지 않습니다. 

Service Bus 트리거가 동적 동시성을 사용 하도록 설정 하려면 Service Bus 확장의 [버전](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.ServiceBus) 5.x를 사용 해야 합니다. 

## <a name="next-steps"></a>다음 단계

자세한 내용은 다음 자료를 참조하세요.

* [Azure Functions에 대한 모범 사례](functions-best-practices.md)
* [Azure Functions 개발자 참조](functions-reference.md)
* [Azure Functions 트리거 및 바인딩](event-driven-scaling.md)
