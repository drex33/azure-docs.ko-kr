---
title: MABS를 사용하여 Azure Stack HCI 가상 머신 백업
description: 이 문서에는 MABS(Microsoft Azure Backup Server)를 사용하여 가상 머신을 백업 및 복구하는 절차가 포함되어 있습니다.
ms.topic: conceptual
ms.date: 07/27/2021
ms.openlocfilehash: e7a653f008541db548b4468a70c429fe72701797
ms.sourcegitcommit: bb1c13bdec18079aec868c3a5e8b33ef73200592
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/27/2021
ms.locfileid: "114722632"
---
# <a name="back-up-azure-stack-hci-virtual-machines-with-azure-backup-server"></a>Azure Backup Server를 사용하여 Azure Stack HCI 가상 머신 백업

이 문서에서는 MABS(Microsoft Azure Backup Server)를 사용하여 Azure Stack HCI의 가상 머신을 백업하는 방법을 설명합니다.

## <a name="supported-scenarios"></a>지원되는 시나리오

MABS는 다음과 같은 시나리오에서 Azure Stack HCI 가상 머신을 백업할 수 있습니다.

- **Azure Stack HCI 호스트**: Azure Stack HCI 호스트의 시스템 상태/BMR을 백업하고 복구합니다. 모든 호스트에 MABS 보호 에이전트를 설치해야 합니다.

- **로컬 또는 직접 스토리지가 있는 클러스터의 가상 머신**: 로컬 또는 직접 연결된 스토리지가 있는 클러스터에서 게스트 가상 머신을 백업합니다. 하드 드라이브, SAN(저장 영역 네트워크) 디바이스 또는 NAS(Network Attached Storage) 디바이스를 예로 들 수 있습니다.

- **CSV 스토리지가 있는 클러스터의 가상 머신**: CSV(클러스터 공유 볼륨) 스토리지가 있는 Azure Stack HCI 클러스터에서 호스트되는 게스트 가상 머신을 백업합니다. MABS 보호 에이전트는 각 클러스터 노드에 설치됩니다.

- **클러스터 내에서 VM 이동**: VM이 확장/일반 클러스터 내에서 이동되면 MABS 보호 에이전트가 Azure Stack HCI 호스트에 설치되어 있는 한, MABS는 가상 머신을 계속 보호합니다. MABS가 가상 머신을 보호하는 방법은 관련된 실시간 마이그레이션의 유형에 따라 다릅니다. 클러스터 내에서 VM 이동을 사용하면 MABS는 마이그레이션을 검색하고, 사용자 개입 없이도 새 클러스터 노드에서 가상 머신을 자동으로 백업합니다. 스토리지 위치가 변경되지 않으므로 MABS에서 빠른 전체 백업을 진행합니다. 

- **다른 확장/일반 클러스터로 VM 이동**: 다른 확장/일반 클러스터로의 VM 이동은 지원되지 않습니다.

## <a name="host-versus-guest-backup"></a>호스트 및 게스트 백업

MABS는 Azure Stack HCI에서 호스트 또는 게스트 수준 백업을 수행할 수 있습니다. 호스트 수준에서 MABS 보호 에이전트는 Azure Stack HCI 호스트 서버 또는 클러스터에 설치되고 해당 호스트에서 실행되는 전체 VM 및 데이터 파일을 보호합니다.   게스트 수준에서 에이전트는 각 가상 머신에 설치되며 해당 컴퓨터에 있는 작업을 보호합니다.

두 방법 모두 장단점이 있습니다.

- 호스트 수준 백업은 게스트 시스템에서 실행되는 OS 유형에 관계없이 작동하며 각 VM에 MABS 보호 에이전트를 설치할 필요가 없으므로 유연합니다. 호스트 수준 백업을 배포하는 경우 전체 가상 머신 또는 파일과 폴더를 복구할 수 있습니다(항목 수준 복구).

- 게스트 수준 백업은 가상 머신에서 실행되는 특정 작업을 보호하려는 경우에 유용합니다. 호스트 수준에서는 전체 VM 또는 특정 파일을 복구할 수 있지만, 특정 애플리케이션의 컨텍스트에서 복구할 수는 없습니다. 예를 들어, 백업된 VM에서 특정 SharePoint 항목을 복구하려면 해당 VM의 게스트 수준 백업을 수행해야 합니다. 통과 디스크에 저장된 데이터를 보호하려면 게스트 수준 백업을 사용합니다. 통과를 사용하면 가상 머신이 스토리지 디바이스에 직접 액세스할 수 있으며 가상 볼륨 데이터가 VHD 파일로 저장되지 않습니다.

## <a name="backup-prerequisites"></a>백업 필수 조건

다음은 MABS를 사용하여 가상 머신을 백업하기 위한 사전 요구 사항입니다.

| 필수 조건 | 세부 정보 |
| ------------ | ------- |
| MABS 사전 요구 사항 | <ul> <li>가상 머신에 대해 항목 수준 복구를 수행하려면(파일, 폴더, 볼륨 복구) MABS 서버에 Hyper-V 역할을 설치해야 합니다. 가상 머신만 복구하고 항목 수준의 복구를 수행하지 않으려면 역할이 필요하지 않습니다.</li> <li>MABS 서버당 최대 800대의 100GB 가상 머신을 보호하고 여러 대의 MABS 서버로 더 큰 클러스터를 지원할 수 있습니다.</li> <li>MABS는 가상 머신 백업 성능을 향상하기 위해 증분 백업에서 페이지 파일을 제외합니다.</li> <li>MABS는 MABS 서버와 동일한 도메인 또는 하위 도메인이나 신뢰할 수 있는 도메인에 있는 서버 또는 클러스터를 백업할 수 있습니다. 작업 그룹 또는 신뢰할 수 없는 도메인에서 VM을 백업하려면 인증을 설정해야 합니다. 단일 서버의 경우 NTLM 또는 인증서 인증을 사용할 수 있습니다. 클러스터의 경우 인증서 인증만 사용할 수 있습니다.</li> <li>호스트 수준의 백업을 사용하여 통과 디스크의 가상 머신 데이터를 백업하는 것은 지원되지 않습니다. 이 시나리오에서는 호스트 수준 백업을 사용하여 VHD 파일을 백업하고 게스트 수준 백업을 사용하여 호스트에 표시되지 않는 다른 데이터를 백업하는 것이 좋습니다.</li> <li>중복 제거된 볼륨에 저장된 VM을 백업할 수 있습니다.</li> </ul> |
| VM | <ul> <li> 가상 머신에서 실행 중인 통합 구성 요소 버전은 Azure Stack HCI 호스트 버전과 동일해야 합니다. </li> <li> 각 가상 머신 백업의 경우 백업 동안 차이점 보관용 디스크(AVHD)에 충분한 공간을 사용할 수 있도록 볼륨에 가상 하드 디스크 파일을 호스팅하는 데 사용 가능한 공간이 필요합니다. 공간은 최소한 계산 초기 디스크 크기 *변동률* 백업 기간 이상이어야 합니다. 클러스터에 복수 백업을 실행하는 경우 이 계산을 사용하여 각 가상 컴퓨터에 AVHD를 수용할 수 있는 충분한 스토리지 용량이 필요합니다. </li> </ul> |
| Linux 필수 구성 요소 | <ul><li> MABS를 사용하여 Linux 가상 머신을 백업할 수 있습니다. 파일에 일관적인 스냅샷만 지원됩니다.</li></ul> |

## <a name="back-up-virtual-machines"></a>가상 컴퓨터 백업

1. [MABS 서버](backup-azure-microsoft-azure-backup.md) 및 [스토리지](backup-mabs-add-storage.md)를 설정합니다. 스토리지를 설정할 때 이러한 스토리지 용량 지침을 따르세요.

   - 가상 머신 평균 크기 - 100GB
   - MABS 서버별 가상 머신 수 - 800
   - VM 800대의 총 크기 - 80TB
   - 백업 스토리지에 필요한 공간 - 80TB

2. 서버 또는 각 클러스터 노드에 MABS 보호 에이전트를 설치합니다.

3. MABS 관리자 콘솔에서 **보호** > **보호 그룹 만들기** 를 선택하여 **새 보호 그룹 만들기** 마법사를 엽니다.

4. **그룹 구성원 선택** 페이지에서 해당 VM이 있는 호스트 서버로부터 보호하려는 VM을 선택합니다. 동일한 보호 정책을 사용할 모든 VM을 하나의 보호 그룹에 넣는 것이 좋습니다. 공간을 효율적으로 사용하려면 공동 배치를 사용하도록 설정합니다. 공동 배치를 사용하면 여러 데이터 원본이 단일 복제본 및 복구 지점 볼륨을 갖도록 동일한 디스크 또는 테이프 스토리지에서 여러 보호 그룹의 데이터를 찾을 수 있습니다.

5. **데이터 보호 방법 선택** 페이지에서 보호 그룹 이름을 지정합니다. Azure Backup 서비스를 사용하여 데이터를 백업하려면 **디스크를 사용하여 단기 보호** 를 선택하고 **온라인 보호** 를 선택합니다.

6. **단기 목표 지정** > **보존 범위** 에서 디스크 데이터를 보존할 기간을 지정합니다. **동기화 빈도** 에서 데이터의 증분 백업을 실행해야 하는 빈도를 지정합니다. 또는 증분 백업의 간격을 선택하는 대신 **복구 지점 직전** 을 사용할 수도 있습니다. 이 설정을 사용하도록 설정하면 각 예약된 복구 지점 직전에 MABS가 빠른 전체 백업을 실행합니다.

    > [!NOTE]
    >애플리케이션 작업을 보호하려는 경우 애플리케이션에서 증분 백업을 지원한다면 동기화 빈도에 따라 복구 지점이 생성됩니다. 애플리케이션에서 증분 백업을 지원하지 않으면 MABS에서는 증분 백업 대신 빠른 전체 백업을 수행하고 빠른 백업 일정에 따라 복구 지점을 만듭니다.<br></br>백업 프로세스는 VM과 연결된 검사점을 백업하지 않습니다.

7. **디스크 할당 검토** 페이지에서 보호 그룹에 대해 할당된 스토리지 풀 디스크 공간을 검토합니다.

   **총 데이터 크기** 는 백업할 데이터의 크기이고 **MABS에서 프로비저닝할 디스크 공간** 은 MABS에서 보호 그룹에 권장하는 공간입니다. MABS는 설정에 따라 가장 적합한 백업 볼륨을 선택합니다. 하지만 사용자가 **디스크 할당 세부 정보** 에서 백업 볼륨 선택을 편집할 수 있습니다. 워크로드에 대한 드롭다운 메뉴에서 원하는 스토리지를 선택합니다. 편집을 통해 **사용 가능한 디스크 스토리지** 창에서 **총 스토리지** 및 **사용 가능한 스토리지** 의 값을 변경합니다. 미달 프로비전된 공간은 향후 원활한 백업이 가능하도록 MABS가 볼륨에 추가하도록 제안하는 스토리지 용량입니다.

8. **복제본 만들기 방법 선택** 페이지에서 보호 그룹의 데이터 초기 복제를 수행할 방법을 지정합니다. **네트워크를 통해 자동으로 복제** 하도록 선택하는 경우 사용량이 많지 않은 시간을 선택하는 것이 좋습니다. 데이터가 많은 양이거나 네트워크 상태가 최적이지 않은 경우 이동식 미디어를 사용하여 오프라인으로 데이터를 복제해야 하는 **수동으로** 를 선택해 보세요.

9. **일관성 확인 옵션** 페이지에서 일관성 확인을 자동화할 방법을 선택합니다. 복제본 데이터에 불일치가 있는 경우에만 또는 일정에 따라 일관성 확인을 실행하도록 활성화할 수 있습니다. 자동 일관성 확인을 구성하지 않더라도 언제든지 보호 그룹을 마우스 오른쪽 단추로 클릭하고 **일관성 확인 수행** 을 선택하여 수동으로 확인할 수 있습니다.

    보호 그룹을 만든 후에 데이터의 최초 복제가 선택한 방법에 따라 발생합니다. 최초 복제 후에는 보호 그룹 설정에 따라 각 백업이 실행됩니다. 백업된 데이터를 복구해야 하는 경우 다음을 참조하세요.

## <a name="back-up-replica-virtual-machines"></a>복제본 가상 컴퓨터 백업

MABS가 Windows Server 2012 R2 이상에서 실행 중인 경우 복제본 가상 머신을 백업할 수 있습니다. 이 기능은 다음 몇 가지 이유로 유용합니다.

**실행 중인 워크로드에 대한 백업의 영향 감소** - 가상 머신의 백업을 수행하면 스냅샷을 만들 때 일부 오버헤드가 발생합니다. 원격 보조 사이트에 백업 프로세스를 오프로드하면 실행 중인 작업이 더 이상 백업 작업의 영향을 받지 않습니다. 이는 원격 사이트에 백업 복사본이 저장되는 배포에만 적용됩니다. 예를 들어, 매일 백업을 수행하고 빠른 복원 시간을 보장하기 위해 로컬로 데이터를 저장할 수 있지만 장기 보존을 위해 원격으로 저장된 복제본 가상 컴퓨터에서 월별 또는 분기별 백업을 수행할 수 있습니다.

**대역폭 절감** - 일반적인 원거리 지사 사무실/본사 배포 시 사이트 간에 백업 데이터를 전송하려면 적절한 양의 프로비전된 대역폭이 필요합니다. 데이터 백업 전략 외에도 복제 및 장애 조치(failover) 전략을 만드는 경우 네트워크를 통해 전송되는 중복 데이터 양을 줄일 수 있습니다. 주 데이터가 아니라 복제본 가상 머신 데이터를 백업하면 네트워크를 통해 백업된 데이터를 보내는 오버헤드를 줄일 수 있습니다.

**호스터 백업을 사용하도록 설정** - 보조 데이터 센터 없이 호스트된 데이터 센터를 복제본 사이트로 사용할 수 있습니다. 이 경우 호스터 SLA는 복제본 가상 머신의 일관된 백업이 필요합니다.

장애 조치를 시작할 때까지 복제본 가상 머신은 꺼져 있으며 VSS는 복제본 가상 머신에 대한 애플리케이션 일치 백업을 보장할 수 없습니다. 그러므로 복제본 가상 머신의 백업은 크래시 일관성만 됩니다. 크래시 일관성을 보장할 수 없는 경우 백업이 실패하며 다음과 같은 다양한 조건에서 발생할 수 있습니다.

- 복제본 가상 머신이 정상 상태가 아니고 위험 상태에 있습니다.

- 복제본 가상 머신을 다시 동기화 중(다시 동기화 진행 중 또는 다시 동기화 필요 상태)입니다.

- 가상 머신에 대해 주 사이트와 보조 사이트 간의 초기 복제가 진행 중이거나 보류 중입니다.

- .hrl 로그를 복제본 가상 머신에 적용하는 중이거나, 가상 디스크에 .hrl 로그를 적용하는 이전 작업이 실패했거나 취소 또는 중단되었습니다.

- 복제본 가상 머신에 대한 마이그레이션 또는 장애 조치가 진행 중입니다.

## <a name="recover-backed-up-virtual-machines"></a>백업된 가상 컴퓨터 복구

백업된 가상 머신을 복구할 수 있는 경우 복구 마법사를 사용하여 가상 머신 및 특정 복구 지점을 선택합니다. 복구 마법사를 열고 가상 머신을 복구하려면

1. MABS 관리자 콘솔에서 VM의 이름을 입력하거나 보호된 항목 목록을 확장하고, **보호된 모든 HyperV 데이터** 로 이동하고, 복구하려는 VM을 선택합니다.

2. **복구 지점 사용 항목** 창의 달력에서 임의의 날짜를 선택하여 사용 가능한 복구 지점을 표시합니다. 그런 다음 **경로** 창에서 복구 마법사에 사용할 복구 지점을 선택합니다.

3. **작업** 메뉴에서 **복구** 를 선택하여 복구 마법사를 엽니다.

    선택한 VM 및 복구 지점이 **복구 선택 사항 확인** 화면에 나타납니다. **다음** 을 선택합니다.

4. **복구 유형 선택** 화면에서 데이터를 복원할 위치를 선택하고 **다음** 을 선택합니다.

    - **원본 인스턴스에 복구**: 원본 인스턴스에 복구하면 원본 VHD와 관련된 모든 검사점이 삭제됩니다. MABS는 Hyper-V VSS 기록기를 사용하여 VHD 및 기타 구성 파일을 원래 위치로 복구합니다. 복구 프로세스가 끝나도 가상 컴퓨터는 항상 사용 가능한 상태로 유지됩니다.
        복구에 사용할 리소스 그룹이 있어야 하며, 사용할 수 없는 경우 대체 위치로 복구한 다음 해당 가상 머신을 항상 사용할 수 있도록 만듭니다.

    - **임의 호스트에 가상 머신으로 복구**: MABS는 ALR(대체 위치 복구)을 지원하여 보호된 Azure Stack HCI 가상 머신을 프로세서 아키텍처와 무관하게 동일한 클러스터 내의 다른 호스트로 원활하게 복구합니다. 클러스터 노드로 복구되는 Azure Stack HCI 가상 머신을 항상 사용할 수 있는 것은 아닙니다. 이 옵션을 선택하면 복구 마법사에서 대상 및 대상 경로를 식별하기 위한 추가 화면을 표시합니다.
    
        >[!NOTE]
        >원본 호스트를 선택하는 경우 동작은 **원본 인스턴스에 복구** 와 동일합니다. 원본 VHD와 연결된 모든 검사점이 삭제됩니다.

    - **네트워크 폴더에 복사**: MABS는 Azure Stack HCI 가상 컴퓨터의 호스트 수준 백업에서 MABS로 보호된 서버의 네트워크 공유나 볼륨으로 파일, 폴더, 볼륨 및 VHD(가상 하드 디스크)의 항목 수준 복구 기능을 제공하는 ILR(항목 수준 복구)을 지원합니다. MABS 보호 에이전트를 게스트에 설치하지 않아도 항목 수준 복구를 사용할 수 있습니다. 이 옵션을 선택하면 복구 마법사에서 대상 및 대상 경로를 식별하기 위한 추가 화면을 표시합니다.

5. **복구 옵션 지정** 에서 복구 옵션을 구성하고 **다음** 을 선택합니다.

    - 낮은 대역폭을 통해 VM을 복구하는 경우 **수정** 을 선택하여 **네트워크 대역폭 사용량 제한** 을 사용하도록 설정합니다. 제한 옵션을 켠 후 제공할 대역폭 양과 대역폭을 사용할 수 있는 시간을 지정할 수 있습니다.
    - 네트워크를 구성한 경우 **하드웨어 스냅샷을 사용한 SAN 기반 복구 사용** 을 선택합니다.
    - 복구 프로세스가 완료되면 메일 알림을 받으려는 경우 **이 복구가 완료되면 전자 메일 보내기** 를 선택한 다음 메일 주소를 입력합니다.

6. 요약 화면에서 모든 세부 정보가 올바른지 확인합니다. 세부 정보가 올바르지 않거나 변경하려면 **뒤로** 를 선택합니다. 설정에 만족하는 경우 **복구** 를 클릭하여 복구 프로세스를 시작합니다.

7. **복구 상태** 화면에서 복구 작업에 대한 정보를 제공합니다.

## <a name="next-steps"></a>다음 단계

[Azure Backup Server에서 데이터 복구](./backup-azure-alternate-dpm-server.md)
