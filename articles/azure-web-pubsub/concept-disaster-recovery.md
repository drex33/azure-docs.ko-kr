---
title: Azure Web PubSub 서비스에서 복원력 및 재해 복구
description: 복원력 및 재해 복구를 달성하기 위해 여러 Azure Web PubSub 서비스 인스턴스를 설정하는 방법에 대한 개요입니다.
author: vicancy
ms.service: azure-web-pubsub
ms.topic: conceptual
ms.date: 10/13/2021
ms.author: lianwei
ms.openlocfilehash: f8d5ee649a3e4e8061f264fb1e2e4280659ff7c3
ms.sourcegitcommit: 611b35ce0f667913105ab82b23aab05a67e89fb7
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/14/2021
ms.locfileid: "130008692"
---
# <a name="resiliency-and-disaster-recovery-in-azure-web-pubsub-service"></a>Azure Web PubSub 서비스에서 복원력 및 재해 복구

복원력 및 재해 복구는 온라인 시스템에 공통적으로 필요합니다. Azure Web PubSub 서비스는 이미 99.9%의 가용성을 보장하지만 여전히 지역 서비스입니다.

서비스 인스턴스는 지역 서비스이며 인스턴스는 한 지역에서 실행됩니다. 지역 전체 가동 중단이 발생하면 서비스가 다른 지역에서 실시간 메시지를 계속 처리하는 것이 중요합니다. 이 문서에서는 재해 복구를 허용하기 위해 서비스를 배포하는 데 사용할 수 있는 몇 가지 전략을 설명합니다.

## <a name="high-available-architecture-for-web-pubsub-service"></a>Web PubSub 서비스에 고가용성 아키텍처

Web PubSub 서비스에 대한 지역 간 복원력을 가지려면 다른 지역에 여러 서비스 인스턴스를 설정해야 합니다. 그러면 하나의 지역이 다운되는 경우 다른 지역을 백업으로 사용할 수 있습니다.

지역 간 시나리오에 대한 일반적인 설정 중 하나는 Web PubSub 서비스 인스턴스와 앱 서버 쌍을 두 개 이상 갖는 것입니다.

각 쌍 앱 서버와 Web PubSub 서비스는 동일한 지역에 있고 Web PubSub 서비스는 이벤트 처리기 업스트림을 동일한 지역의 앱 서버로 설정합니다.

아키텍처를 더 잘 설명하기 위해 Web PubSub 서비스를 동일한 쌍의 앱 서버에 대한 "기본" 서비스라고 합니다. 또한 다른 쌍의 Web PubSub 서비스를 앱 서버에 대한 "보조" 서비스로 호출합니다.

애플리케이션 서버는 [서비스 상태 검사 API를](/rest/api/webpubsub/health-api/get-service-status) 사용하여 "기본" 및 "보조" 서비스가 정상인지 여부를 검색합니다. 예를 들어 라는 Web PubSub 서비스의 경우 `demo` 서비스가 `https://demo.webpubsub.azure.com/api/health` 정상이면 엔드포인트가 200을 반환합니다. 앱 서버는 정기적으로 엔드포인트를 호출하거나 요청 시 엔드포인트를 호출하여 엔드포인트가 정상 상태인지 확인할 수 있습니다. WebSocket 클라이언트는 일반적으로 웹 PubSub 서비스에 연결하는 URL을 얻기 위해 먼저 애플리케이션 서버와 **협상하고,** 애플리케이션은 이 **협상** 단계를 사용하여 클라이언트를 다른 정상 "보조" 서비스로 장애 조치합니다. 아래와 같은 자세한 단계:

1. 클라이언트가 앱 서버와 **협상하는** 경우 앱 서버는 기본 Web PubSub 서비스 엔드포인트만 반환해야 하므로 일반적인 경우 클라이언트는 기본 엔드포인트에만 연결됩니다.

2. 주 인스턴스가 다운된 경우 **협상은** 클라이언트가 계속 연결할 수 있도록 정상 보조 엔드포인트를 반환하고 클라이언트는 보조 엔드포인트에 연결해야 합니다.

3. 앱 서버가 여러 클라이언트에 메시지를 "브로드캐스트"하려는 경우 "기본" 및 "보조"를 포함하여 모든 "정상" 엔드포인트에 메시지를 "브로드캐스트"해야 합니다.

이 토폴로지를 사용하면 모든 앱 서버와 Web PubSub 서비스 인스턴스가 상호 연결되기 때문에 한 서버의 메시지가 모든 클라이언트에 배달될 수 있습니다.

다음은 이러한 토폴로지를 보여주는 다이어그램입니다.

![다이어그램은 각각 앱 서버와 Web PubSub 서비스가 있는 두 지역을 보여 하며, 각 서버는 주 지역의 Web PubSub 서비스와 보조 서버로 다른 지역의 서비스와 연결됩니다.](media/concept-disaster-recovery/topology.png)

## <a name="failover-sequence-and-best-practice"></a>장애 조치(Failover) 시퀀스와 모범 사례

이제 올바른 시스템 토폴로지 설정이 완료되었습니다. 한 Web PubSub 서비스 인스턴스가 다운될 때마다 온라인 트래픽이 다른 인스턴스로 라우팅됩니다.
기본 인스턴스가 다운되는 경우 다음과 같은 상황이 발생합니다(그리고 얼마 후 복구됨).

1. 주 서비스 인스턴스가 다운되면 이 인스턴스에 연결된 모든 클라이언트가 삭제됩니다.
2. 새 클라이언트 또는 다시 연결 클라이언트가 앱 서버와 **협상**
2. 앱 서버는 주 서비스 인스턴스가 다운된 것을 감지하고 협상 시 이 엔드포인트 반환을 중지하고 정상 보조 엔드포인트 반환을 시작합니다.
3. 클라이언트는 보조 인스턴스에 연결합니다.
4. 이제 보조 인스턴스가 모든 온라인 트래픽을 사용하게 됩니다. 보조가 모든 앱 서버에 연결되므로 서버에서 클라이언트로 가는 모든 메시지는 계속 배달될 수 있습니다. 그러나 클라이언트-서버 이벤트 메시지는 동일한 지역의 업스트림 앱 서버로만 전송됩니다.
5. 주 인스턴스가 복구되고 다시 온라인 상태이면 앱 서버에서 주 인스턴스가 정상으로 돌아간 것을 감지합니다. 새로운 클라이언트가 기본에 다시 연결되므로 이제 협상은 기본 엔드포인트를 다시 반환합니다. 그러나 기존 클라이언트는 삭제되지 않으며 연결을 끊을 때까지 보조에 계속 연결됩니다.

아래 다이어그램에서는 장애 조치(failover)가 수행되는 방법을 보여 줍니다.

그림 1. 장애 조치(failover) 전![장애 조치(failover) 전](media/concept-disaster-recovery/before-failover.png)

그림 2. 장애 조치(failover) 후![장애 조치(failover) 후](media/concept-disaster-recovery/after-failover.png)

그림 3. 기본 복구 후 잠시 동안 ![기본 복구 후 잠시 동안](media/concept-disaster-recovery/after-recover.png)

일반적인 경우 기본 앱 서버와 Web PubSub 서비스에만 온라인 트래픽(파란색)이 있는 것을 볼 수 있습니다.

장애 조치(failover) 후 보조 앱 서버 및 Web PubSub 서비스도 활성화됩니다.
기본 Web PubSub 서비스가 다시 온라인이 되면 새 클라이언트가 기본 Web PubSub에 연결됩니다. 하지만 기존 클라이언트는 두 인스턴스 모두에 트래픽이 있으므로 계속 보조에 연결됩니다.

모든 기존 클라이언트 연결이 끊긴 후, 시스템은 정상으로 돌아갑니다(그림 1).

지역 간 고가용성 아키텍처를 구현하기 위한 두 가지 주요 패턴이 있습니다.

1. 첫 번째는 모든 온라인 트래픽을 사용하는 앱 서버와 Web PubSub 서비스 인스턴스 쌍을 만들고 다른 쌍을 백업으로 사용하는 것입니다(Fig.1에 설명된 활성/수동이라고 함). 
2. 다른 하나는 두 개 이상의 앱 서버 쌍과 Web PubSub 서비스 인스턴스를 갖는 것입니다. 각 쌍은 온라인 트래픽에 참여하고 다른 쌍(Fig.3과 유사하게 활성/활성이라고 함)에 대한 백업 역할을 합니다.

Web PubSub 서비스는 두 패턴을 모두 지원할 수 있습니다. 주요 차이점은 앱 서버를 구현하는 방법입니다.
앱 서버가 활성/수동인 경우 기본 앱 서버가 기본 Web PubSub 서비스 인스턴스만 반환하기 때문에 Web PubSub 서비스도 활성/수동이 됩니다.
앱 서버가 활성/활성 상태인 경우 Web PubSub 서비스도 활성/활성화됩니다(모든 앱 서버가 자체 기본 Web PubSub 인스턴스를 반환하므로 모든 앱 서버가 트래픽을 얻을 수 있음).

사용하도록 선택한 패턴에 관계없이 각 Web PubSub 서비스 인스턴스를 앱 서버에 "기본" 역할로 연결해야 합니다.

또한 WebSocket 연결의 특성(긴 연결)으로 인해 재해 및 장애 조치(failover)가 발생할 때 클라이언트는 연결이 끊깁니다.
최종 고객에게 명료하도록 그러한 경우를 클라이언트 쪽에서 처리해야 합니다. 예를 들어 연결을 닫은 후 다시 연결을 수행합니다.

## <a name="next-steps"></a>다음 단계

이 문서에서는 Web PubSub 서비스에 대한 복원력을 달성하도록 애플리케이션을 구성하는 방법을 배웠습니다. 

[!INCLUDE [next step](includes/include-next-step.md)]