---
title: Azure Portal을 사용하여 Azure Firewall 배포 및 구성
description: 이 문서에서는 Azure Portal을 사용하여 Azure Firewall을 배포하고 구성하는 방법을 알아봅니다.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: how-to
ms.date: 11/10/2021
ms.author: victorh
ms.custom: mvc
ms.openlocfilehash: 99b7d27ef16414df161b7d6e120084f2b8220f46
ms.sourcegitcommit: 677e8acc9a2e8b842e4aef4472599f9264e989e7
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 11/11/2021
ms.locfileid: "132297528"
---
# <a name="deploy-and-configure-azure-firewall-using-the-azure-portal"></a>Azure Portal을 사용하여 Azure Firewall 배포 및 구성

아웃바운드 네트워크 액세스 제어는 전체 네트워크 보안 계획에서 중요한 부분입니다. 예를 들어 웹 사이트에 대한 액세스를 제한할 수 있습니다. 또는 액세스 가능한 아웃바운드 IP 주소 및 포트를 제한할 수 있습니다.

Azure 서브넷에서 아웃바운드 네트워크로의 액세스를 제어하는 한 가지 방법은 Azure Firewall입니다. Azure Firewall을 사용하면 다음을 구성할 수 있습니다.

* 서브넷에서 액세스할 수 있는 FQDN(정규화된 도메인 이름)을 정의하는 애플리케이션 규칙.
* 원본 주소, 프로토콜, 대상 포트 및 대상 주소를 정의하는 네트워크 규칙.

네트워크 트래픽은 서브넷 기본 게이트웨이처럼 방화벽에 네트워크 트래픽을 라우팅할 경우 구성된 방화벽 규칙에 종속됩니다.

이 문서에서는 배포가 용이하도록 두 개의 서브넷을 사용하여 간소화된 단일 VNet을 만듭니다.

프로덕션 배포의 경우 [허브 및 스포크 모델](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke)이 권장되며 방화벽은 자체 VNet에 있습니다. 워크로드 서버는 하나 이상의 서브넷이 있는 동일한 지역에서 피어링된 VNet에 있습니다.

* **AzureFirewallSubnet** - 방화벽은 이 서브넷에 있습니다.
* **워크로드-SN** - 워크로드 서버는 이 서브넷에 있습니다. 이 서브넷의 네트워크 트래픽은 방화벽을 통해 이동합니다.

![네트워크 인프라](media/tutorial-firewall-deploy-portal/tutorial-network.png)

이 문서에서는 다음 방법을 설명합니다.

> [!div class="checklist"]
> * 테스트 네트워크 환경 설정
> * 방화벽 배포
> * 기본 경로 만들기
> * [www.google.com]\(www.google.com) 액세스를 허용하도록 애플리케이션 규칙 구성
> * 외부 DNS 서버 액세스를 허용하도록 네트워크 규칙 구성
> * 테스트 서버에 대한 원격 데스크톱을 허용하도록 NAT 규칙 구성
> * 방화벽 테스트

> [!NOTE]
> 이 문서에서는 클래식 방화벽 규칙을 사용하여 방화벽을 관리합니다. 선호되는 방법은 [방화벽 정책](../firewall-manager/policy-overview.md)을 사용하는 것입니다. 방화벽 정책을 사용하여 이 절차를 완료하려면 [자습서: Azure Portal을 사용하여 Azure Firewall과 정책 배포 및 구성](tutorial-firewall-deploy-portal-policy.md)을 참조하세요.

원하는 경우 [Azure PowerShell](deploy-ps.md)을 사용하여 이 절차를 완료할 수 있습니다.

## <a name="prerequisites"></a>사전 요구 사항

Azure 구독이 아직 없는 경우 시작하기 전에 [체험 계정](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)을 만듭니다.

## <a name="set-up-the-network"></a>네트워크 설정

먼저 방화벽 배포에 필요한 리소스를 포함하는 리소스 그룹을 만듭니다. 그런 다음, VNet, 서브넷 및 테스트 서버를 만듭니다.

### <a name="create-a-resource-group"></a>리소스 그룹 만들기

리소스 그룹에는 이 절차에 사용된 모든 리소스가 포함되어 있습니다.

1. [https://portal.azure.com](https://portal.azure.com)에서 Azure Portal에 로그인합니다.
2. Azure Portal 메뉴에서 **리소스 그룹** 을 선택하거나 검색하여 어느 페이지에서든 *리소스 그룹* 을 선택합니다. 그런 다음, **추가** 를 선택합니다.
4. **구독** 의 경우 사용자의 구독을 선택합니다.
1. **리소스 그룹 이름** 에 *Test-FW-RG* 를 입력합니다.
1. **리소스 그룹 위치** 의 경우 위치를 선택합니다. 만드는 다른 모든 리소스는 동일한 위치에 있어야 합니다.
1. **검토 + 만들기** 를 선택합니다.
1. **만들기** 를 선택합니다.

### <a name="create-a-vnet"></a>VNet 만들기

이 VNet에는 세 개의 서브넷이 있습니다.

> [!NOTE]
> AzureFirewallSubnet 서브넷의 크기는 /26입니다. 서브넷 크기에 대한 자세한 내용은 [Azure Firewall FAQ](firewall-faq.yml#why-does-azure-firewall-need-a--26-subnet-size)를 참조하세요.

1. Azure Portal 메뉴 또는 **홈** 페이지에서 **리소스 만들기** 를 선택합니다.
1. **네트워킹** > **가상 네트워크** 를 선택합니다.
1. **만들기** 를 선택합니다.
1. **구독** 의 경우 사용자의 구독을 선택합니다.
1. **리소스 그룹** 의 경우 **Test-FW-RG** 를 선택합니다.
1. **이름** 에 **Test-FW-VN** 을 입력합니다.
1. **지역** 의 경우 전에 사용한 것과 동일한 위치를 선택합니다.
1. 완료되면 **다음: IP 주소** 를 선택합니다.
1. **IPv4 주소 공간** 에 **10.0.0.0/16** 을 입력합니다.
1. **서브넷** 아래에서 **기본값** 을 선택합니다.
1. **서브넷 이름** 에 **AzureFirewallSubnet** 을 입력합니다. 방화벽은 이 서브넷에 있고 해당 서브넷 이름은 AzureFirewallSubnet이 **되어야** 합니다.
1. **주소 범위** 에 **10.0.1.0/26** 을 입력합니다.
1. **저장** 을 선택합니다.

   다음으로, 워크로드 서버용 서브넷을 만듭니다.

1. **서브넷 추가** 를 선택합니다.
4. **서브넷 이름** 에 **워크로드-SN** 을 입력합니다.
5. **서브넷 주소 범위** 에 대해 **10.0.2.0/24** 를 입력합니다.
6. **추가** 를 선택합니다.
7. **검토 + 만들기** 를 선택합니다.
8. **만들기** 를 선택합니다.

### <a name="create-a-virtual-machine"></a>가상 머신 만들기

이제 워크로드 가상 머신을 만들어 **워크로드-SN** 서브넷에 배치합니다.

1. Azure Portal 메뉴 또는 **홈** 페이지에서 **리소스 만들기** 를 선택합니다.
2. **Windows Server 2016 Datacenter** 를 선택합니다.
4. 가상 머신에 대해 다음 값을 입력합니다.

   |설정  |값  |
   |---------|---------|
   |Resource group     |**Test-FW-RG**|
   |가상 머신 이름     |**Srv-Work**|
   |지역     |이전과 동일함|
   |이미지|Windows Server 2016 Datacenter|
   |관리자 사용자 이름     |사용자 이름 입력|
   |암호     |암호 입력|

4. **인바운드 포트 규칙**, **퍼블릭 인바운드 포트** 에서 **없음** 을 선택합니다.
6. 나머지는 기본값으로 두고 **다음: 디스크** 를 선택합니다.
7. 디스크는 기본값으로 두고 **다음: 네트워킹** 을 선택합니다.
8. 가상 네트워크에 **Test-FW-VN** 이 선택되고 서브넷이 **워크로드-SN** 인지 확인합니다.
9. **공용 IP** 에 대해 **없음** 을 선택합니다.
11. 나머지는 기본값으로 두고 **다음: 관리** 를 선택합니다.
12. **사용 안 함** 을 선택하여 부팅 진단을 비활성화합니다. 나머지는 기본값으로 두고 **검토 + 만들기** 를 선택합니다.
13. 요약 페이지에서 설정을 검토한 다음, **만들기** 를 선택합니다.

[!INCLUDE [ephemeral-ip-note.md](../../includes/ephemeral-ip-note.md)]

## <a name="deploy-the-firewall"></a>방화벽 배포

VNet에 방화벽을 배포합니다.

1. Azure Portal 메뉴 또는 **홈** 페이지에서 **리소스 만들기** 를 선택합니다.
2. 검색 상자에 **방화벽** 을 입력하고 **Enter** 키를 누릅니다.
3. **방화벽** 을 선택하고 **만들기** 를 선택합니다.
4. **방화벽 만들기** 페이지에서 다음 표를 사용하여 방화벽을 구성합니다.

   |설정  |값  |
   |---------|---------|
   |구독     |\<your subscription\>|
   |Resource group     |**Test-FW-RG** |
   |Name     |**Test-FW01**|
   |지역     |전에 사용한 동일한 위치 선택|
   |방화벽 관리|**방화벽 규칙(클래식)을 사용하여 이 방화벽 관리**|
   |가상 네트워크 선택     |**기존 리소스 사용**: **Test-FW-VN**|
   |공용 IP 주소     |**새로 추가**<br>**이름**: **fw-pip**|

5. 다른 기본값을 적용한 다음, **검토 + 만들기** 를 선택합니다.
6. 요약을 검토한 다음, **만들기** 를 선택하여 방화벽을 만듭니다.

   이 설정은 배포하는 데 몇 분 정도 걸립니다.
7. 배포가 완료되면 **Test-FW-RG** 리소스 그룹으로 이동하고 **Test-FW01** 방화벽을 선택합니다.
8. 방화벽 개인 및 공용 IP 주소를 확인합니다. 나중에 이러한 주소를 사용합니다.

## <a name="create-a-default-route"></a>기본 경로 만들기

방화벽을 통해 아웃바운드 및 인바운드 연결에 대한 경로를 만들 때 가상 어플라이언스 개인 IP를 다음 홉으로 사용하여 0.0.0.0/0에 대한 기본 경로로 충분합니다. 이렇게 하면 방화벽을 통과하기 위해 나가는 연결과 들어오는 연결을 처리합니다. 예를 들어 방화벽이 TCP 핸드셰이크를 수행하고 들어오는 요청에 응답하는 경우 응답은 트래픽을 보낸 IP 주소로 전달됩니다. 이것은 의도적인 것입니다. 

따라서 AzureFirewallSubnet IP 범위를 포함하기 위해 추가 UDR을 만들 필요가 없습니다. 이로 인해 연결이 끊어질 수 있습니다. 원래 기본 경로로 충분합니다.

**Workload-SN** 서브넷의 경우 방화벽을 통과하도록 아웃바운드 기본 경로를 구성합니다.

1. Azure Portal 메뉴에서 **모든 서비스** 를 선택하거나 검색하여 어느 페이지에서든 *모든 서비스* 를 선택합니다.
2. **네트워킹** 아래에서 **경로 테이블** 을 선택합니다.
3. **추가** 를 선택합니다.
5. **구독** 의 경우 사용자의 구독을 선택합니다.
6. **리소스 그룹** 의 경우 **Test-FW-RG** 를 선택합니다.
7. **지역** 의 경우 전에 사용한 것과 동일한 위치를 선택합니다.
4. **이름** 에 **Firewall-route** 를 입력합니다.
1. **검토 + 만들기** 를 선택합니다.
1. **만들기** 를 선택합니다.

배포가 완료되면 **리소스로 이동** 을 선택합니다.

1. 방화벽 경로 페이지에서 **서브넷** 을 선택한 다음, **연결** 을 선택합니다.
1. **가상 네트워크** > **Test-FW-VN** 을 선택합니다.
1. **서브넷** 에 대해 **Workload-SN** 을 선택합니다. 이 경로에 대해 **Workload-SN** 서브넷만 선택해야 합니다. 그렇지 않으면 방화벽이 제대로 작동하지 않습니다.

13. **확인** 을 선택합니다.
14. **경로** 를 선택한 다음, **추가** 를 선택합니다.
15. **경로 이름** 에 **fw-dg** 를 입력합니다.
16. **주소 접두사** 에 **0.0.0.0/0** 을 입력합니다.
17. **다음 홉 형식** 의 경우 **가상 어플라이언스** 를 선택합니다.

    Azure Firewall은 실제로 관리되는 서비스이지만 가상 어플라이언스는 이 상황에서 작동합니다.
18. **다음 홉 주소** 에 이전에 적어둔 방화벽에 대한 개인 IP 주소를 입력합니다.
19. **확인** 을 선택합니다.

## <a name="configure-an-application-rule"></a>애플리케이션 규칙 구성

이는 `www.google.com`에 대한 아웃바운드 액세스를 허용하는 애플리케이션 규칙입니다.

1. **Test-FW-RG** 를 열고 **Test-FW01** 방화벽을 선택합니다.
2. **Test-FW01** 페이지의 **설정** 에서 **규칙(클래식)** 을 선택합니다.
3. **애플리케이션 규칙 컬렉션** 탭을 선택합니다.
4. **애플리케이션 규칙 컬렉션 추가** 를 선택합니다.
5. **이름** 에 **App-Coll01** 를 입력합니다.
6. **우선 순위** 에 **200** 을 입력합니다.
7. **동작** 에 대해 **허용** 을 선택합니다.
8. **규칙**, **대상 FQDN** 아래에서 **이름** 으로 **Allow-Google** 을 입력합니다.
9. **원본 유형** 에 대해 **IP 주소** 를 선택합니다.
10. **원본** 에 대해 **10.0.2.0/24** 를 선택합니다.
11. **Protocol:port** 에 **http, https** 를 입력합니다.
12. **대상 FQDN** 에 **`www.google.com`** 을 입력합니다.
13. **추가** 를 선택합니다.

Azure Firewall은 기본적으로 허용되는 인프라 FQDN에 대한 기본 제공 규칙 컬렉션을 포함합니다. 이러한 FQDN은 플랫폼에 대해 특정적이며 다른 용도로 사용할 수 없습니다. 자세한 내용은 [인프라 FQDN](infrastructure-fqdns.md)을 참조하세요.

## <a name="configure-a-network-rule"></a>네트워크 규칙 구성

포트 53(DNS)에서 두 IP 주소에 대한 아웃바운드 액세스를 허용하는 네트워크 규칙입니다.

1. **네트워크 규칙 컬렉션** 탭을 선택합니다.
2. **네트워크 규칙 컬렉션 추가** 를 선택합니다.
3. **이름** 에 **Net-Coll01** 을 입력합니다.
4. **우선 순위** 에 **200** 을 입력합니다.
5. **동작** 에 대해 **허용** 을 선택합니다.
6. **규칙**, **IP 주소** 아래에서 **이름** 에 대해 **Allow-DNS** 를 입력합니다.
7. **프로토콜** 로 **UDP** 를 선택합니다.
9. **원본 유형** 에 대해 **IP 주소** 를 선택합니다.
1. **원본** 에 대해 **10.0.2.0/24** 를 선택합니다.
2. **대상 유형** 에 대해 **IP 주소** 를 선택합니다.
3. **대상 주소** 에 대해 **209.244.0.3,209.244.0.4** 를 입력합니다.

   이것들은 CenturyLink에서 작동하는 공용 DNS 서버입니다.
1. **대상 포트** 에 **53** 을 입력합니다.
2. **추가** 를 선택합니다.

## <a name="configure-a-dnat-rule"></a>DNAT 규칙 구성

이 규칙을 사용하면 방화벽을 통해 원격 데스크톱을 Srv-Work 가상 머신에 연결할 수 있습니다.

1. **NAT 규칙 컬렉션** 탭을 선택합니다.
2. **NAT 규칙 컬렉션 추가** 를 선택합니다.
3. **이름** 에 **rdp** 를 입력합니다.
4. **우선 순위** 에 **200** 을 입력합니다.
5. **규칙** 에서 **이름** 에 **rdp-nat** 을 입력합니다.
6. **프로토콜** 의 경우 **TCP** 를 선택합니다.
7. **원본 유형** 에 대해 **IP 주소** 를 선택합니다.
8. **원본** 에 대해 **\*** 를 선택합니다.
9. **대상 주소** 에 방화벽 공용 IP 주소를 입력합니다.
10. **대상 포트** 에 대해 **3389** 를 입력합니다.
11. **변환 주소** 에 **Srv-work** 개인 IP 주소를 입력합니다.
12. **변환 포트** 에 **3389** 를 입력합니다.
13. **추가** 를 선택합니다.


### <a name="change-the-primary-and-secondary-dns-address-for-the-srv-work-network-interface"></a>**Srv-Work** 네트워크 인터페이스에 대해 기본 및 보조 DNS 주소 변경

테스트 목적으로 서버의 기본 및 보조 DNS 주소를 구성합니다. 일반적인 Azure Firewall 요구 사항이 아닙니다.

1. Azure Portal 메뉴에서 **리소스 그룹** 을 선택하거나 검색하여 어느 페이지에서든 *리소스 그룹* 을 선택합니다. **Test-FW-RG** 리소스 그룹을 선택합니다.
2. **Srv-Work** 가상 머신에 대해 네트워크 인터페이스를 선택합니다.
3. **설정** 아래에서 **DNS 서버** 를 선택합니다.
4. **DNS 서버** 아래에서 **사용자 지정** 을 선택합니다.
5. **DNS 서버 추가** 텍스트 상자에 **209.244.0.3** 을 입력하고 다음 텍스트 상자에 **209.244.0.4** 를 입력합니다.
6. **저장** 을 선택합니다.
7. **Srv-Work** 가상 머신을 다시 시작합니다.

## <a name="test-the-firewall"></a>방화벽 테스트

이제 방화벽이 예상대로 작동하는지 테스트합니다.

1. 원격 데스크톱을 방화벽 공용 IP 주소에 연결하고 **Srv-Work** 가상 머신에 로그인합니다. 
3. Internet Explorer를 열고 [https://www.google.com]\(`https://www.google.com`)을 찾습니다.
4. Internet Explorer 보안 경고에서 **확인** > **닫기** 를 선택합니다.

   Google 홈 페이지가 나타납니다.

5. [https://www.microsoft.com]\(`https://www.microsoft.com` ) 로 이동합니다.

   방화벽에서 차단해야 합니다.

이제 방화벽 규칙이 작동하는지 확인했습니다.

* 다른 모든 FQDN이 아닌 허용된 FQDN 하나만 찾아볼 수 있습니다.
* 구성된 외부 DNS 서버를 사용하여 DNS 이름을 확인할 수 있습니다.

## <a name="clean-up-resources"></a>리소스 정리

테스트를 계속하도록 방화벽 리소스를 그대로 유지하거나, 더 이상 필요하지 않은 경우 **Test-FW-RG** 리소스 그룹을 삭제하여 모든 방화벽 관련 리소스를 삭제해도 됩니다.

## <a name="next-steps"></a>다음 단계

[자습서: Azure Firewall 로그 모니터링](./firewall-diagnostics.md)