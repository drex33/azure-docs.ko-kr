---
title: '자습서: 포털을 사용하여 Azure Firewall DNAT 정책으로 인바운드 인터넷 트래픽 필터링'
description: 이 자습서에서는 Azure Portal을 사용하여 Azure Firewall 정책 DNAT를 배포하고 구성하는 방법을 알아봅니다.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: tutorial
ms.date: 08/26/2021
ms.author: victorh
ms.custom: mvc
ms.openlocfilehash: 2f863c9fc5bad369813ee37c51ded73e96980a54
ms.sourcegitcommit: 03f0db2e8d91219cf88852c1e500ae86552d8249
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/27/2021
ms.locfileid: "123034209"
---
# <a name="tutorial-filter-inbound-internet-traffic-with-azure-firewall-policy-dnat-using-the-azure-portal"></a>자습서: Azure Portal을 사용하여 Azure Firewall 정책 DNAT로 인바운드 인터넷 트래픽 필터링

서브넷에 대한 인바운드 인터넷 트래픽을 변환하고 필터링하도록 Azure Firewall 정책 DNAT(Destination Network Address Translation)를 구성할 수 있습니다. DNAT를 구성하면 *규칙 컬렉션 작업* 이 **DNAT** 로 설정됩니다. 그 후 NAT 규칙 컬렉션의 각 규칙을 사용하여 방화벽 공용 IP 주소 및 포트를 개인 IP 주소 및 포트로 변환할 수 있습니다. DNAT 규칙은 해당 네트워크 규칙을 암시적으로 추가하여 변환된 트래픽을 허용합니다. 보안상의 이유로, 네트워크에 대한 DNAT 액세스를 허용하고 와일드카드를 사용하지 않도록 하기 위해 특정 인터넷 원본을 추가하는 것이 좋습니다. Azure Firewall 규칙 처리 논리에 대한 자세한 내용은 [Azure Firewall 규칙 처리 논리](rule-processing.md)를 참조하세요.

이 자습서에서는 다음 작업 방법을 알아봅니다.

> [!div class="checklist"]
> * 테스트 네트워크 환경 설정
> * 방화벽 및 정책 배포
> * 기본 경로 만들기
> * DNAT 규칙 구성
> * 방화벽 테스트

## <a name="prerequisites"></a>필수 구성 요소

Azure 구독이 아직 없는 경우 시작하기 전에 [체험 계정](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)을 만듭니다.



## <a name="create-a-resource-group"></a>리소스 그룹 만들기

1. [https://portal.azure.com](https://portal.azure.com)에서 Azure Portal에 로그인합니다.
2. Azure Portal 홈페이지에서 **리소스 그룹** 과 **추가** 를 차례로 선택합니다.
4. **구독** 의 경우 사용자의 구독을 선택합니다.
1. **리소스 그룹 이름** 에 대해 **RG-DNAT-Test** 를 입력합니다.
5. **지역** 에 대해 지역을 선택합니다. 만드는 다른 모든 리소스는 동일한 지역에 있어야 합니다.
6. **검토 + 만들기** 를 선택합니다.
1. **만들기** 를 선택합니다.

## <a name="set-up-the-network-environment"></a>네트워크 환경 설정

이 자습서에서는 두 개의 피어링된 VNet을 만듭니다.

- **VN-Hub** - 방화벽이 이 VNet에 있습니다.
- **VN-Spoke** - 워크로드 서버가 이 VNet에 있습니다.

먼저 VNet을 만든 다음, 이를 피어링합니다.

### <a name="create-the-hub-vnet"></a>허브 VNet 만들기

1. Azure Portal 홈 페이지에서 **모든 서비스** 를 선택합니다.
2. **네트워킹** 아래에서 **가상 네트워크** 를 선택합니다.
3. **추가** 를 선택합니다.
7. **리소스 그룹** 의 경우 **RG-DNAT-Test** 를 선택합니다.
1. **이름** 에 대해 **VN-Hub** 를 입력합니다.
1. **지역** 에 대해 이전에 사용한 것과 동일한 지역을 선택합니다.
1. 완료되면 **다음: IP 주소** 를 선택합니다.
1. **IPv4 주소 공간** 의 경우 기본값 **10.0.0.0/16** 을 적용합니다.
1. **서브넷 이름** 아래에서 **기본값** 을 선택합니다.
1. **서브넷 이름** 을 편집하고 **AzureFirewallSubnet** 을 입력합니다.

     방화벽은 이 서브넷에 있고 해당 서브넷 이름은 AzureFirewallSubnet이 **되어야** 합니다.
     > [!NOTE]
     > AzureFirewallSubnet 서브넷의 크기는 /26입니다. 서브넷 크기에 대한 자세한 내용은 [Azure Firewall FAQ](firewall-faq.yml#why-does-azure-firewall-need-a--26-subnet-size)를 참조하세요.

10. **서브넷 주소 범위** 에 **10.0.1.0/26** 을 입력합니다.
11. **저장** 을 선택합니다.
1. **검토 + 만들기** 를 선택합니다.
1. **만들기** 를 선택합니다.

### <a name="create-a-spoke-vnet"></a>스포크 VNet 만들기

1. Azure Portal 홈 페이지에서 **모든 서비스** 를 선택합니다.
2. **네트워킹** 아래에서 **가상 네트워크** 를 선택합니다.
3. **추가** 를 선택합니다.
1. **리소스 그룹** 의 경우 **RG-DNAT-Test** 를 선택합니다.
1. **이름** 에 대해 **VN-Spoke** 를 입력합니다.
1. **지역** 에 대해 이전에 사용한 것과 동일한 지역을 선택합니다.
1. 완료되면 **다음: IP 주소** 를 선택합니다.
1. **IPv4 주소 공간** 의 경우 기본값을 편집하고 **192.168.0.0/16** 을 입력합니다.
1. **서브넷 추가** 를 선택합니다.
1. **서브넷 이름** 으로 **SN-Workload** 를 입력합니다.
10. **서브넷 주소 범위** 에 **192.168.1.0/24** 를 입력합니다.
11. **추가** 를 선택합니다.
1. **검토 + 만들기** 를 선택합니다.
1. **만들기** 를 선택합니다.

### <a name="peer-the-vnets"></a>VNet 피어링

이제 두 개의 VNet을 피어링합니다.

1. **VN-Hub** 가상 네트워크를 선택합니다.
2. **설정** 에서 **피어링** 을 선택합니다.
3. **추가** 를 선택합니다.
4. **이 가상 네트워크** 에서 **피어링 링크 이름** 으로 **Peer-HubSpoke** 를 입력합니다.
5. **원격 가상 네트워크** 에서 **피어링 링크 이름** 으로 **Peer-SpokeHub** 를 입력합니다. 
1. 가상 네트워크에 대해 **VN-Spoke** 를 선택합니다.
1. 다른 모든 항목에 대해 기본값을 적용한 다음, **추가** 를 선택합니다.

## <a name="create-a-virtual-machine"></a>가상 머신 만들기

워크로드 가상 머신을 만들어 **SN-Workload** 서브넷에 배치합니다.

1. Azure Portal 메뉴에서 **리소스 만들기** 를 선택합니다.
2. **인기** 아래에서 **Windows Server 2016 Datacenter** 를 선택합니다.

**기본 사항**

1. **구독** 의 경우 사용자의 구독을 선택합니다.
1. **리소스 그룹** 의 경우 **RG-DNAT-Test** 를 선택합니다.
1. **가상 머신 이름** 에 **Srv-Workload** 를 입력합니다.
1. **지역** 의 경우 전에 사용한 것과 동일한 위치를 선택합니다.
1. 사용자 이름 및 암호를 입력합니다.
1. 완료되면 **다음: 디스크** 를 선택합니다.

**디스크**
1. 완료되면 **다음: 네트워킹** 을 선택합니다.

**네트워킹**

1. **가상 네트워크** 에 대해 **VN-Spoke** 를 선택합니다.
2. **서브넷** 에 대해 **SN-Workload** 를 선택합니다.
3. **공용 IP** 에 대해 **없음** 을 선택합니다.
4. **공용 인바운드 포트** 에 대해 **없음** 을 선택합니다. 
2. 다른 기본 설정을 그대로 적용하고 **다음: 관리** 를 선택합니다.

**관리**

1. **부트 진단** 에 대해 **사용 안 함** 을 선택합니다.
1. **검토 + 만들기** 를 선택합니다.

**검토 + 만들기**

요약을 검토한 다음, **만들기** 를 선택합니다. 이 설정은 완료하는 데 몇 분 정도 걸립니다.

배포가 완료되면 가상 머신에 대한 개인 IP 주소를 적어 둡니다. 나중에 방화벽을 구성할 때 사용됩니다. 가상 머신 이름을 선택하고, **설정** 아래에서 **네트워킹** 을 선택하여 개인 IP 주소를 찾습니다.

## <a name="deploy-the-firewall-and-policy"></a>방화벽 및 정책 배포

1. 포털 홈 페이지에서 **리소스 만들기** 를 선택합니다.
1. **방화벽** 을 검색한 후 **방화벽** 을 선택합니다.
1. **만들기** 를 선택합니다. 
1. **방화벽 만들기** 페이지에서 다음 표를 사용하여 방화벽을 구성합니다.

   |설정  |값  |
   |---------|---------|
   |구독     |\<your subscription\>|
   |Resource group     |**RG-DNAT-Test** 를 선택합니다. |
   |속성     |**FW-DNAT-test**|
   |지역     |전에 사용한 동일한 위치 선택|
   |방화벽 관리|**방화벽 정책을 사용하여 이 방화벽 관리**|
   |방화벽 정책|**새로 추가**:<br>**fw-dnat-pol**<br>선택한 지역 
   |가상 네트워크 선택     |**기존 항목 사용**: VN-Hub|
   |공용 IP 주소     |**새**, 이름: **fw-pip** 를 추가합니다.|

5. 나머지는 기본값으로 두고 **검토 + 만들기** 를 선택합니다.
6. 요약을 검토한 다음, **만들기** 를 선택하여 방화벽을 만듭니다.

   배포하는 데 몇 분 정도 걸립니다.
7. 배포가 완료되면 **RG-DNAT-Test** 리소스 그룹으로 이동하고 **FW-DNAT-test** 방화벽을 선택합니다.
8. 방화벽의 개인 및 공용 IP 주소를 적어둡니다. 나중에 기본 경로 및 NAT 규칙을 만들 때 사용합니다.

## <a name="create-a-default-route"></a>기본 경로 만들기

**SN-Workload** 서브넷의 경우 방화벽을 통과하도록 아웃바운드 기본 경로를 구성합니다.

1. Azure Portal 홈 페이지에서 **모든 서비스** 를 선택합니다.
2. **네트워킹** 아래에서 **경로 테이블** 을 선택합니다.
3. **추가** 를 선택합니다.
5. **구독** 의 경우 사용자의 구독을 선택합니다.
1. **리소스 그룹** 의 경우 **RG-DNAT-Test** 를 선택합니다.
1. **지역** 에 대해 이전에 사용한 것과 동일한 지역을 선택합니다.
1. **이름** 에 **RT-FW-route** 를 입력합니다.
1. **검토 + 만들기** 를 선택합니다.
1. **만들기** 를 선택합니다.
1. **리소스로 이동** 을 선택합니다.
1. **서브넷** 을 선택한 다음, **연결** 을 선택합니다.
1. **가상 네트워크** 에 대해 **VN-Spoke** 를 선택합니다.
1. **서브넷** 에 대해 **SN-Workload** 를 선택합니다.
1. **확인** 을 선택합니다.
1. **경로** 를 선택한 다음, **추가** 를 선택합니다.
1. **경로 이름** 에 **fw-dg** 를 입력합니다.
1. **주소 접두사** 에 **0.0.0.0/0** 을 입력합니다.
1. **다음 홉 형식** 의 경우 **가상 어플라이언스** 를 선택합니다.

    Azure Firewall은 실제로 관리되는 서비스이지만 가상 어플라이언스는 이 상황에서 작동합니다.
18. **다음 홉 주소** 에 이전에 적어둔 방화벽에 대한 개인 IP 주소를 입력합니다.
19. **확인** 을 선택합니다.

## <a name="configure-a-nat-rule"></a>NAT 규칙 구성

이 규칙을 사용하면 방화벽을 통해 원격 데스크톱을 Srv-Workload 가상 머신에 연결할 수 있습니다.

1. **RG-DNAT-Test** 리소스 그룹을 열고 **fw-dnat-pol** 방화벽 정책을 선택합니다. 
1. **설정** 아래에서 **DNAT 규칙** 을 선택합니다.
2. **규칙 컬렉션 추가** 를 선택합니다.
3. **이름** 에 **rdp** 를 입력합니다.
1. **우선 순위** 에 **200** 을 입력합니다.
1. **규칙 컬렉션 그룹** 에 대해 **DefaultDnatRuleCollectionGroup** 을 선택합니다.
1. **규칙** 에서 **이름** 에 **rdp-nat** 을 입력합니다.
1. **원본 유형** 에 대해 **IP 주소** 를 선택합니다.
1. **원본** 에 대해 **\*** 를 선택합니다.
1. **프로토콜** 의 경우 **TCP** 를 선택합니다.
1. **대상 포트** 에 대해 **3389** 를 입력합니다.
1. **대상 유형** 에 대해 **IP 주소** 를 선택합니다.
1. **대상** 에 방화벽 공용 IP 주소를 입력합니다.
1. **변환 주소** 에 **Srv-Workload** 개인 IP 주소를 입력합니다.
1. **변환 포트** 에 **3389** 를 입력합니다.
1. **추가** 를 선택합니다.


## <a name="test-the-firewall"></a>방화벽 테스트

1. 원격 데스크톱을 방화벽 공용 IP 주소에 연결합니다. **Srv-Workload** 가상 머신에 연결되어 있어야 합니다.
2. 원격 데스크톱을 닫습니다.

## <a name="clean-up-resources"></a>리소스 정리

다음 자습서에서 사용하기 위해 방화벽 리소스를 그대로 유지하거나, 더 이상 필요하지 않은 경우 **RG-DNAT-Test** 리소스 그룹을 삭제하여 모든 방화벽 관련 리소스를 삭제할 수 있습니다.

## <a name="next-steps"></a>다음 단계

> [!div class="nextstepaction"]
> [Azure Firewall 프리미엄 배포 및 구성](premium-deploy.md)