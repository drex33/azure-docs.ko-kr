---
title: 변경이 불가능한 Blob 데이터에 대한 시간 기반 보존 정책
titleSuffix: Azure Storage
description: 시간 기반 보존 정책은 Blob 데이터를 지정된 간격 동안 WORM(한 번 쓰기, 여러 번 읽기) 상태로 저장합니다. 범위가 Blob 버전(미리 보기) 또는 컨테이너로 지정된 시간 기반 보존 정책을 구성할 수 있습니다.
services: storage
author: tamram
ms.service: storage
ms.topic: conceptual
ms.date: 07/22/2021
ms.author: tamram
ms.subservice: blobs
ms.openlocfilehash: ed76c271590b4f5fbc79c7713b70186a8d9eb426
ms.sourcegitcommit: f6e2ea5571e35b9ed3a79a22485eba4d20ae36cc
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 09/24/2021
ms.locfileid: "128552069"
---
# <a name="time-based-retention-policies-for-immutable-blob-data"></a>변경이 불가능한 Blob 데이터에 대한 시간 기반 보존 정책

시간 기반 보존 정책은 Blob 데이터를 지정된 간격 동안 WORM(한 번 쓰기, 여러 번 읽기) 형식으로 저장합니다. 시간 기반 보존 정책이 설정되면 클라이언트에서 Blob을 만들고 읽을 수 있지만 수정하거나 삭제할 수는 없습니다. 보존 간격이 만료되면 Blob을 삭제할 수 있지만 덮어쓸 수는 없습니다.

Blob Storage 불변성 정책에 대한 자세한 내용은 [비즈니스에 중요한 BLOB 데이터를 변경이 불가능한 스토리지에 저장](immutable-storage-overview.md)을 참조하세요.

## <a name="retention-interval-for-a-time-based-policy"></a>시간 기반 정책의 보존 간격

시간 기반 보존 정책의 최소 보존 간격은 1일이고, 최댓값은 146,000일(400년)입니다.

시간 기반 보존 정책을 구성하면 영향을 받는 개체가 *유효* 보존 기간 동안 변경이 불가능한 상태로 유지됩니다. 개체의 유효 보존 기간은 Blob을 만든 시간과 사용자가 지정 보존 간격의 차이와 같습니다. 정책의 보존 간격을 연장할 수 있으므로 변경이 불가능한 스토리지는 사용자가 지정한 보존 간격의 가장 최근 값을 사용하여 유효 보존 기간을 계산합니다.

예를 들어 사용자가 보존 기간 5년의 시간 기반 보존 정책을 만든다고 가정합니다. 해당 컨테이너의 기존 *testblob1* Blob이 1년 전에 만들어졌으므로 *testblob1* 의 유효 보존 기간은 4년입니다. 새 *testblob2* Blob이 컨테이너에 업로드되면 *testblob2* 의 유효 보존 기간은 만든 시점으로부터 5년입니다.

## <a name="locked-versus-unlocked-policies"></a>잠긴 정책 및 잠금 해제된 정책

시간 기반 보존 정책을 처음 구성하면 테스트 목적으로 정책이 잠금 해제됩니다. 테스트가 완료되면 SEC 17a-4(f) 및 기타 규정 준수를 완전히 준수하도록 정책을 잠글 수 있습니다.

잠긴 정책 및 잠금 해제된 정책은 모두 삭제 및 덮어쓰기로부터 보호합니다. 그러나 잠금 해제된 정책은 보존 기간을 줄이거나 늘려서 수정할 수 있습니다. 잠금 해제된 정책을 삭제할 수도 있습니다.

잠긴 시간 기반 보존 정책은 삭제할 수 없습니다. 보존 기간은 늘릴 수 있지만 줄일 수는 없습니다. 컨테이너 수준에서 정의된 잠긴 정책의 수명 동안 유효 보존 기간을 최대 5회 늘릴 수 있습니다. Blob 버전에 대해 구성된 정책의 경우 유효 기간 증가 횟수에 대한 제한이 없습니다.

> [!IMPORTANT]
> SEC 17a-4(f) 및 기타 규정을 준수하도록 Blob을 규격을 준수하고 변경할 수 없는 상태(쓰기 및 삭제 금지)로 유지하려면 시간 기반 보존 정책을 잠가야 합니다. 적절한 시간(일반적으로 24시간 이내)에 정책을 잠그는 것이 좋습니다. 잠금 해제된 상태는 불변성 보호를 제공하지만, 단기 테스트 이외의 용도로 잠금 해제된 상태를 사용하지 않는 것이 좋습니다.

## <a name="time-based-retention-policy-scope"></a>시간 기반 보존 정책 범위

시간 기반 보존 정책은 다음 범위 중 하나로 구성할 수 있습니다.

- 버전 수준 정책(미리 보기): 중요한 데이터를 세부적으로 관리하기 위해 Blob 버전에 적용하도록 시간 기반 보존 정책을 구성할 수 있습니다. 정책을 개별 버전에 적용하거나 해당 컨테이너에 업로드된 모든 Blob에 기본적으로 적용되는 컨테이너에 대한 기본 정책을 구성할 수 있습니다.
- 컨테이너 수준 정책: 컨테이너 수준에서 구성된 시간 기반 보존 정책은 해당 컨테이너의 모든 개체에 적용됩니다. 개별 개체는 자체의 고유한 불변성 정책으로 구성할 수 없습니다.

감사 로그는 버전 수준 및 컨테이너 수준 시간 기반 보존 정책 모두에 대해 컨테이너에서 사용할 수 있습니다. 범위가 Blob 버전으로 지정된 정책에는 감사 로그를 사용할 수 없습니다.

### <a name="version-level-policy-scope-preview"></a>버전 수준 정책 범위(미리 보기)

버전 수준 보존 정책을 구성하려면 먼저 부모 컨테이너에서 버전 수준 불변성을 사용하도록 설정해야 합니다. 버전 수준 불변성이 사용하도록 설정되면 사용하지 않도록 설정할 수 없지만 잠금 해제된 정책은 삭제할 수 있습니다. 자세한 내용은 [컨테이너에서 버전 수준 불변성 지원 사용](immutable-policy-configure-version-scope.md#enable-support-for-version-level-immutability-on-a-container)을 참조하세요.

컨테이너를 만들 때 버전 수준 불변성에 대한 지원을 사용 하도록 설정할 수 있습니다. 기존 컨테이너도 버전 수준 불변성을 지원할 수 있지만 먼저 마이그레이션 프로세스를 거쳐야 합니다. 이 프로세스는 시간이 다소 걸릴 수 있으며 되돌릴 수 없습니다. 버전 수준 불변성을 지원하도록 컨테이너를 마이그레이션하는 방법에 대한 자세한 내용은 [버전 수준 불변성을 지원하도록 기존 컨테이너 마이그레이션](immutable-policy-configure-version-scope.md#migrate-an-existing-container-to-support-version-level-immutability)을 참조하세요.

버전 수준 시간 기반 보존 정책을 사용하려면 [Blob 버전 관리](versioning-overview.md)를 스토리지 계정에 사용하도록 설정해야 합니다. Blob 버전 관리를 사용하도록 설정하는 방법을 알아보려면 [Blob 버전 관리 사용 및 관리](versioning-enable.md)를 참조하세요. 버전 관리를 사용하도록 설정하면 청구에 영향을 줄 수 있습니다. 자세한 내용은 [Blob 버전 관리](versioning-overview.md#pricing-and-billing)의 **가격 책정 및 청구** 섹션을 참조하세요.

버전 관리가 사용하도록 설정되면 Blob이 처음 업로드될 때 해당 버전의 Blob이 현재 버전입니다. Blob을 덮어쓸 때마다 이전 Blob 상태를 저장하는 새 버전이 만들어집니다. 현재 버전의 Blob을 삭제하면 현재 버전은 이전 버전이 되며 명시적으로 삭제할 때까지 유지됩니다. 이전 Blob 버전에는 현재 버전이 이전 버전이 되었을 때 적용된 시간 기반 보존 정책이 있습니다.

기본 정책이 컨테이너에 적용되는 경우 덮어쓰기 작업에서 이전 버전을 만들 때 새 현재 버전에서 컨테이너에 대한 기본 정책을 상속합니다.

각 버전에는 하나의 시간 기반 보존 정책만 구성되어 있을 수 있습니다. 버전에는 하나의 법적 보류가 구성되어 있을 수도 있습니다. 범위에 따라 지원되는 불변성 정책을 구성하는 방법에 대한 자세한 내용은 [불변성 정책 범위](immutable-storage-overview.md#immutability-policy-scope)를 참조하세요.

버전 수준 시간 기반 보존 정책을 구성하는 방법에 대한 자세한 내용은 [Blob 버전에 대한 불변성 정책 구성(미리 보기)](immutable-policy-configure-version-scope.md)을 참조하세요.

> [!IMPORTANT]
> 버전 수준 시간 기반 보존 정책은 현재 **미리 보기** 에 있습니다. 베타, 미리 보기로 제공되거나 아직 일반 공급으로 릴리스되지 않은 Azure 기능에 적용되는 약관은 [Microsoft Azure 미리 보기에 대한 추가 사용 약관](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)을 참조하세요.
> 버전 수준 불변성이 사용하도록 설정된 후 버전 수준 시간 기반 보존 정책을 구성할 수 있을 때까지 최대 30초가 걸릴 수 있습니다.

#### <a name="configure-a-policy-on-the-current-version"></a>현재 버전에 대한 정책 구성

컨테이너에 대한 버전 수준 불변성 지원이 사용하도록 설정되면 컨테이너에 대한 기본 시간 기반 보존 정책을 구성할 수 있습니다. 컨테이너에 대한 기본 시간 기반 보존 정책을 구성한 다음, Blob을 업로드하면 Blob에서 기본적으로 해당 정책을 상속합니다. 또한 Blob에 대한 사용자 지정 정책을 구성하여 업로드 시 해당 Blob에 대한 기본 정책을 재정의하도록 선택할 수 있습니다.

컨테이너에 대한 기본 시간 기반 보존 정책이 잠금 해제된 경우 기본 정책을 상속하는 현재 버전의 Blob에도 잠금 해제된 정책이 있습니다. 개별 Blob이 업로드되면 현재 버전의 Blob에 대한 정책의 보존 기간을 줄이거나 늘리거나 현재 버전을 삭제할 수 있습니다. 또한 컨테이너에 대한 기본 정책이 잠금 해제된 상태로 유지되는 경우에도 현재 버전에 대한 정책을 잠글 수 있습니다.

컨테이너에 대한 기본 시간 기반 보존 정책이 잠겨 있으면 기본 정책을 상속하는 현재 버전의 Blob에도 잠긴 정책이 있습니다. 그러나 해당 Blob에 대해서만 정책을 설정하여 Blob을 업로드할 때 기본 정책을 재정의하면 해당 Blob의 정책이 명시적으로 잠글 때까지 잠금 해제된 상태로 유지됩니다. 현재 버전의 정책이 잠기면 보존 간격을 늘릴 수 있지만 정책을 삭제하거나 보존 간격을 줄일 수는 없습니다.

컨테이너에 대해 구성된 기본 정책이 없는 경우 사용자 지정 정책을 사용하거나 정책을 사용하지 않고 Blob을 업로드할 수 있습니다.

컨테이너에 대한 기본 정책이 수정되면 해당 컨테이너 내의 개체에 대한 정책이 기본 정책에서 상속된 경우에도 변경되지 않은 상태로 유지됩니다.

다음 표에서는 업로드 시 Blob에 대한 시간 기반 보존 정책을 설정하는 데 사용할 수 있는 다양한 옵션을 보여 줍니다.

| 컨테이너에 대한 기본 정책 상태 | 기본 정책을 사용하여 Blob 업로드 | 사용자 지정 정책을 사용하여 Blob 업로드 | 정책을 사용하지 않고 Blob 업로드 |
|--|--|--|--|
| 컨테이너에 대한 기본 정책(잠금 해제됨) | Blob이 잠금 해제된 기본 정책을 사용하여 업로드됨 | Blob이 잠금 해제된 사용자 지정 정책을 사용하여 업로드됨 | Blob이 정책을 사용하지 않고 업로드됨 |
| 컨테이너에 대한 기본 정책(잠김) | Blob이 잠긴 기본 정책을 사용하여 업로드됨 | Blob이 잠금 해제된 사용자 지정 정책을 사용하여 업로드됨 | Blob이 정책을 사용하지 않고 업로드됨 |
| 컨테이너에 대한 기본 정책이 없음 | 해당 없음 | Blob이 잠금 해제된 사용자 지정 정책을 사용하여 업로드됨 | Blob이 정책을 사용하지 않고 업로드됨 |

#### <a name="configure-a-policy-on-a-previous-version"></a>이전 버전에 대한 정책 구성

버전 관리가 사용하도록 설정되면 Blob에 대한 쓰기 또는 삭제 작업에서 작업 전에 Blob의 상태를 저장하는 해당 Blob의 새 이전 버전을 만듭니다. 기본적으로 현재 버전이 이전 버전이 되면 해당 이전 버전에는 현재 버전에 적용된 시간 기반 보존 정책(있는 경우)이 있습니다. 컨테이너에 대한 정책이 있는 경우 새 현재 버전에서 해당 정책을 상속합니다.

이전 버전에서 상속된 정책이 잠금 해제되면 보존 간격을 줄이거나 늘리거나 정책을 삭제할 수 있습니다. 또한 현재 버전에 대한 정책이 잠금 해제된 경우에도 이전 버전에 대한 정책은 해당 버전에 대해 잠길 수 있습니다.

이전 버전에서 상속된 정책이 잠기면 보존 간격을 늘릴 수 있습니다. 정책은 삭제할 수 없으며 보존 간격도 줄일 수 없습니다.

현재 버전에 구성된 정책이 없으면 이전 버전에서 정책을 상속하지 않습니다. 버전에 대한 사용자 지정 정책은 구성할 수 있습니다.

현재 버전에 대한 정책이 수정되면 정책이 현재 버전에서 상속된 경우에도 기존 이전 버전에 대한 정책이 변경되지 않은 상태로 유지됩니다.

### <a name="container-level-policy-scope"></a>컨테이너 수준 정책 범위

컨테이너 수준 시간 기반 보존 정책은 컨테이너의 모든 개체(새 개체 및 기존 개체 포함)에 적용됩니다. 계층 구조 네임스페이스가 있는 계정의 경우 컨테이너 수준 정책은 컨테이너의 모든 디렉터리에도 적용됩니다.

시간 기반 보존 정책이 컨테이너에 적용되면 기존의 모든 Blob이 30초 이내에 변경이 불가능한 WORM 상태로 이동합니다. 해당 정책으로 보호되는 컨테이너에 업로드되는 모든 새 Blob도 변경이 불가능한 상태로 이동합니다. 모든 Blob이 변경이 불가능한 상태가 되면 변경이 불가능한 컨테이너에서 덮어쓰기 또는 삭제 작업이 허용되지 않습니다. 계층 구조 네임스페이스가 있는 계정의 경우 Blob의 이름을 바꾸거나 Blob을 다른 디렉터리로 이동할 수 없습니다.

컨테이너 수준 보존 정책에 적용되는 제한 사항은 다음과 같습니다.

- 스토리지 계정의 경우 변경이 불가능한 시간 기반 정책이 잠겨 있는 컨테이너의 최대 수는 10,000개입니다.
- 컨테이너의 경우 잠긴 시간 기반 정책에 대한 보존 간격을 늘리기 위한 최대 편집 횟수는 5회입니다.
- 컨테이너의 경우 잠긴 정책에 대해 최대 7개의 시간 기반 보존 정책 감사 로그가 보존됩니다.

컨테이너에 대한 시간 기반 보존 정책을 구성하는 방법을 알아보려면 [컨테이너에 대한 불변성 정책 구성](immutable-policy-configure-container-scope.md)을 참조하세요.

## <a name="allow-protected-append-blobs-writes"></a>보호된 추가 Blob 쓰기 허용

추가 Blob은 데이터 블록으로 구성되며 감사 및 로깅 시나리오에 필요한 데이터 추가 작업에 최적화되어 있습니다. 기본적으로 추가 Blob은 Blob의 끝에 새 블록을 추가할 수 있습니다. 불변성에 관계없이 추가 Blob에서 기존 블록을 수정하거나 삭제하는 작업은 기본적으로 허용되지 않습니다. 추가 Blob에 대한 자세한 내용은 [추가 Blob 정보](/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-append-blobs)를 참조하세요.

시간 기반 보존 정책에만 불변성 보호 및 규정 준수를 유지하면서 새 블록을 추가 Blob에 쓸 수 있도록 허용하는 **AllowProtectedAppendWrites** 속성 설정이 있습니다. 이 설정이 사용하도록 설정되면 추가 Blob을 정책으로 보호되는 컨테이너에 직접 만든 다음, 블록 추가 작업을 통해 새 데이터 블록을 추가 Blob의 끝에 계속 추가할 수 있습니다. 새 블록만 추가할 수 있으며, 기존 블록은 수정하거나 삭제할 수 없습니다. 시간 보존 불변성 보호는 계속 적용되어 유효 보존 기간이 경과할 때까지 추가 Blob 삭제를 방지합니다. 이 설정을 사용하도록 설정해도 블록 Blob 또는 페이지 Blob의 불변성 동작에 영향을 주지 않습니다.

이 설정은 시간 기반 보존 정책의 일부이므로 추가 Blob은 *유효* 보존 기간 동안 변경이 불가능한 상태로 유지됩니다. 추가 Blob의 초기 생성 이후에 새 데이터를 추가할 수 있으므로 보존 기간이 결정되는 방식에 약간의 차이가 있습니다. 유효 보존은 추가 Blob의 마지막 수정 시간과 사용자가 지정한 보존 간격 간의 차이입니다. 마찬가지로 보존 간격이 늘어나면 변경이 불가능한 스토리지는 사용자가 지정한 보존 간격의 가장 최근 값을 사용하여 유효 보존 기간을 계산합니다.

예를 들어 사용자가 **AllowProtectedAppendWrites** 속성이 사용하도록 설정되고 보존 간격이 90일인 시간 기반 보존 정책을 만든다고 가정합니다. 오늘 *logblob1* 추가 Blob이 컨테이너에 만들어지고, 새 로그가 다음 10일 동안 추가 Blob에 계속 추가되므로 *logblob1* 의 유효 보존 기간은 오늘부터 100일(마지막으로 추가한 시간 + 90일)입니다.

잠금 해제된 시간 기반 보존 정책을 사용하면 **언제든지 AllowProtectedAppendWrites** 속성 설정을 사용하도록 설정하고 사용하지 않도록 설정할 수 있습니다. 시간 기반 보존 정책이 잠기면 **AllowProtectedAppendWrites** 속성 설정을 변경할 수 없습니다.

## <a name="audit-logging"></a>감사 로깅

시간 기반 보존 정책이 사용하도록 설정된 각 컨테이너는 정책 감사 로그를 제공합니다. 감사 로그에는 잠긴 시간 기반 보존 정책에 대한 최대 7개의 시간 기반 보존 명령이 포함됩니다. 로그 항목에는 사용자 ID, 명령 유형, 타임스탬프 및 보존 간격이 포함됩니다. 감사 로그는 SEC 17a-4(f) 규정 지침에 따라 정책의 수명 동안 유지됩니다.

[Azure 활동 로그](../../azure-monitor/essentials/platform-logs-overview.md)는 모든 관리 서비스 활동에 대한 더 포괄적인 로그를 제공합니다. [Azure 리소스 로그](../../azure-monitor/essentials/platform-logs-overview.md)는 데이터 작업에 대한 정보를 유지합니다. 이러한 로그는 규정 또는 다른 목적으로 필요할 수 있으므로 사용자가 로그를 지속적으로 저장할 책임이 있습니다.

버전 수준의 시간 기반 보존 정책에 대한 변경 내용은 감사되지 않습니다.

## <a name="next-steps"></a>다음 단계

- [데이터 보호 개요](data-protection-overview.md)
- [비즈니스에 중요한 BLOB 데이터를 변경이 불가능한 스토리지에 저장](immutable-storage-overview.md)
- [변경이 불가능한 Blob 데이터에 대한 법적 보존](immutable-legal-hold-overview.md)
- [Blob 버전에 대한 불변성 정책 구성(미리 보기)](immutable-policy-configure-version-scope.md)
- [컨테이너에 대한 불변성 정책 구성](immutable-policy-configure-container-scope.md)
