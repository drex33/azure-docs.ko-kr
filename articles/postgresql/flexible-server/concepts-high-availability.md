---
title: Azure Database for PostgreSQL - 유연한 서버(미리 보기)를 사용한 영역 중복 고가용성 개요
description: Azure Database for PostgreSQL - 유연한 서버를 사용하여 영역 중복 고가용성 개념에 대해 알아보기
author: sr-msft
ms.author: srranga
ms.service: postgresql
ms.topic: conceptual
ms.date: 09/22/2020
ms.openlocfilehash: c0d9b6042ae695caa73d926653f237b756bf4971
ms.sourcegitcommit: f28ebb95ae9aaaff3f87d8388a09b41e0b3445b5
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/29/2021
ms.locfileid: "94366726"
---
# <a name="high-availability-concepts-in-azure-database-for-postgresql---flexible-server"></a>Azure Database for PostgreSQL - 유연한 서버의 고가용성 개념

> [!IMPORTANT]
> Azure Database for PostgreSQL - 유연한 서버는 미리 보기로 제공됨

Azure Database for PostgreSQL - 유연한 서버는 **영역 중복** 서버 배포를 사용하여 자동 장애 조치(failover) 기능이 있는 고가용성 구성을 제공합니다. 영역 중복 구성으로 배포하는 경우 유동 서버는 다른 가용성 영역에서 대기 복제본을 자동으로 프로비저닝하고 관리합니다. PostgreSQL 스트리밍 복제를 사용하여 **동기** 모드의 대기 복제본 서버에 데이터가 복제됩니다. 

영역 중복 구성을 사용하면 사용자가 시작한 스케일 컴퓨팅 작업과 같은 계획된 이벤트 도중뿐만 아니라 기본 하드웨어 및 소프트웨어 오류, 네트워크 오류, 가용성 영역 오류와 같은 계획되지 않은 이벤트 중에도 데이터 손실 없이 자동 장애 조치(failover) 기능을 사용할 수 있습니다. 

:::image type="content" source="./media/business-continuity/concepts-zone-redundant-high-availability-architecture.png" alt-text="영역 중복 고가용성"::: 

## <a name="zone-redundant-high-availability-architecture"></a>영역 중복 고가용성 아키텍처

지역 및 가용성 영역을 선택하여 기본 데이터베이스 서버를 배포할 수 있습니다. 대기 복제본 서버는 컴퓨팅 계층, 컴퓨팅 크기, 스토리지 크기 및 네트워크 구성을 포함하여 주 서버와 동일한 구성으로 다른 가용성 영역에 프로비저닝됩니다. 트랜잭션 로그는 PostgreSQL 스트리밍 복제를 사용하여 대기 복제본에 동기 모드로 복제됩니다. 자동 백업은 주 데이터베이스 서버에서 주기적으로 수행되고 트랜잭션 로그는 대기 복제본에서 백업 스토리지로 지속적으로 보관됩니다. 

고가용성 구성의 상태는 지속적으로 모니터링되고 포털에서 보고됩니다. 영역 중복 고가용성 상태는 다음과 같습니다.

| **Status** | **설명** |
| ------- | ------ |
| <b> 초기화하는 중 | 새로운 대기 서버를 만드는 과정에서 |
| <b> 데이터 복제 중 | 대기 서버를 만든 후에 주 서버의 데이터를 받는 중입니다. |
| <b> 정상 | 복제가 정상 상태이며 정상입니다. |
| <b> 장애 조치(Failover) | 데이터베이스 서버가 대기 서버로 장애 조치(failover)하는 프로세스 중에 있습니다. |
| <b> 대기 제거 | 대기 서버를 삭제하는 중입니다. | 
| <b> 사용 안 함 | 영역 중복 고가용성이 사용하도록 설정되어 있지 않습니다.  |

## <a name="steady-state-operations"></a>정상 상태 작업

PostgreSQL 클라이언트 애플리케이션은 DB 서버 이름을 사용하여 주 서버에 연결됩니다. 애플리케이션 읽기는 주 서버에서 직접 제공되는 반면 커밋 및 쓰기는 데이터가 주 서버와 대기 복제본 모두에서 지속된 후에만 애플리케이션에 적용됩니다. 이러한 추가 왕복 요구 사항으로 인해 애플리케이션은 쓰기 및 커밋에 대한 대기 시간이 증가할 것으로 예상할 수 있습니다. 포털에서 고가용성의 상태를 모니터링할 수 있습니다.

:::image type="content" source="./media/business-continuity/concepts-high-availability-steady-state.png" alt-text="영역 중복 고가용성 - 정상 상태"::: 

1. 클라이언트는 유연한 서버에 연결하고 쓰기 작업을 수행합니다.
2. 변경 사항은 대기 사이트에 복제됩니다.
3. 주 서버는 승인을 받습니다.
4. 쓰기/커밋이 승인됩니다.

## <a name="failover-process---planned-downtimes"></a>장애 조치(failover) 프로세스 - 계획된 가동 중지 시간

계획된 가동 중지 시간 이벤트에는 Azure 예약 정기 소프트웨어 업데이트 및 사소한 버전 업그레이드가 포함됩니다. 고가용성으로 구성된 경우 이러한 작업은 애플리케이션이 주 서버에 계속 액세스하는 동안 먼저 대기 복제본에 적용됩니다. 대기 복제본이 업데이트되면 주 서버 연결이 비워지고 동일한 데이터베이스 서버 이름의 주 서버가 되도록 대기 복제본을 활성화하는 장애 조치(failover)가 트리거됩니다. 클라이언트 애플리케이션은 동일한 데이터베이스 서버 이름으로 새 주 서버에 다시 연결해야 하며 작업을 재개할 수 있습니다. 새 대기 서버는 이전 주 서버와 동일한 영역에 설정됩니다. 

scale-compute 또는 scale-storage와 같은 다른 사용자 시작 작업의 경우 변경 사항은 대기에 먼저 적용되고 그 다음에 주 서버에 적용됩니다. 현재 연결은 대기로 장애 조치(failover)되지 않으므로 작업이 주 서버에서 수행되는 동안 가동 중지 시간이 발생합니다.

### <a name="reducing-planned-downtime-with-managed-maintenance-window"></a>관리되는 유지 관리 기간으로 계획된 가동 중지 시간 감소

 데이터베이스에 대한 작업이 적을 것으로 예상되는 날짜에 30분의 기간을 선택하여 Azure에서 시작한 유지 관리 작업을 예약할 수 있습니다. 패치 또는 사소한 버전 업그레이드와 같은 Azure 유지 관리 작업이 해당 기간 동안 발생합니다.  고가용성으로 구성된 유연한 서버의 경우 이러한 유지 관리 작업은 대기 복제본에서 먼저 수행된 다음 활성화됩니다. 그런 다음 애플리케이션은 새 주 서버에 다시 연결하고 새 대기 서버가 프로비저닝되는 동안 작업을 재개합니다.

## <a name="failover-process---unplanned-downtimes"></a>장애 조치(failover) 프로세스 - 계획되지 않은 가동 중지 시간

계획되지 않은 가동 중단에는 소프트웨어 버그 또는 인프라 구성 요소 오류가 포함되며 이는 데이터베이스 가용성에 영향을 미칩니다. 모니터링 시스템에서 서버 사용 불가 상태가 감지되면 대기 복제본으로의 복제가 단절되며 대기 복제본이 주 데이터베이스 서버로 활성화됩니다. 클라이언트는 동일한 연결 문자열을 사용하여 데이터베이스 서버에 다시 연결하고 작업을 재개할 수 있습니다. 전체 장애 조치(failover) 시간은 60~120초가 소요될 것으로 예상됩니다. 그러나 장애 조치(failover) 시 대용량 트랜잭션, 복구 시간 등 주 데이터베이스 서버의 작업에 따라 장애 조치(failover)가 더 오래 걸릴 수 있습니다.

:::image type="content" source="./media/business-continuity/concepts-high-availability-failover-state.png" alt-text="영역 중복 고가용성 - 장애 조치(failover)"::: 

1. 주 데이터베이스 서버가 중단되고 클라이언트의 데이터베이스 연결이 끊어집니다. 
2. 대기 서버가 활성화되어 새 주 서버가 됩니다. 클라이언트는 동일한 연결 문자열을 사용하여 새 주 서버에 연결합니다. 클라이언트 애플리케이션이 주 데이터베이스 서버와 동일한 영역에 있으면 대기 시간이 줄어들고 성능이 향상됩니다.
3. 대기 서버는 기존 주 서버와 동일한 영역에 구축되며 스트리밍 복제가 시작됩니다. 
4. 정상 상태 복제가 설정되면 데이터가 두 사이트에 모두 유지된 후 클라이언트 애플리케이션이 커밋되고 쓰기가 승인됩니다.

## <a name="point-in-time-restore"></a>지정 시간 복원 

고가용성으로 구성된 유연한 서버는 데이터를 실시간으로 대기 서버에 복제하여 최신 상태로 유지합니다. 실수로 테이블을 삭제하거나 잘못된 데이터 업데이트와 같은 주 서버의 모든 사용자 오류는 대기 복제본에 충실하게 복제됩니다. 따라서 이러한 논리적 오류를 복구하기 위해 대기를 사용할 수 없습니다. 이러한 오류를 복구하려면 백업을 통해 특정 시점 복원을 수행해야 합니다.  유연한 서버의 특정 시점 복원 기능을 사용하여 오류가 발생하기 전의 시간으로 복원할 수 있습니다. 고가용성으로 구성된 데이터베이스의 경우 새 데이터베이스 서버는 사용자가 제공한 이름의 단일 영역 유연한 서버로 복원됩니다. 그런 다음 데이터베이스 서버에서 개체를 내보내 프로덕션 데이터베이스 서버로 가져올 수 있습니다. 마찬가지로 테스트 및 개발 목적으로 데이터베이스 서버를 복제하거나 다른 목적으로 복원하려는 경우 특정 시점 복원을 수행할 수 있습니다.

## <a name="zone-redundant-high-availability---features"></a>영역 중복 고가용성 - 기능

-   대기 복제본은 vCore, 스토리지, 네트워크 설정(VNET, 방화벽) 등을 포함하여 주 서버와 동일한 VM 구성으로 배포됩니다.

-   기존 데이터베이스 서버에 고가용성을 추가하는 기능.

-   고가용성을 사용하지 않도록 설정하여 대기 복제본을 제거할 수 있습니다.

-   주 데이터베이스 서버의 가용성 영역을 선택하는 기능

-   주 데이터베이스 서버 및 대기 데이터베이스 서버를 모두 중지, 시작 및 다시 시작하는 기능

-   자동 백업은 주 데이터베이스 서버에서 수행되고 영역 중복 스토리지에 저장됩니다.

-   클라이언트는 항상 주 데이터베이스 서버에 연결합니다.

-   서버를 다시 시작하여 정적 서버 매개 변수의 변경 내용을 선택할 수 있습니다.
  
-   사소한 버전 업그레이드와 같은 주기적인 유지 관리 작업은 대기 상태에서 먼저 발생하고 서비스가 장애 조치(failover)되어 가동 중지 시간을 줄입니다.  

## <a name="zone-redundant-high-availability---limitations"></a>영역 중복 고가용성 - 제한 사항

-   버스트 가능한 컴퓨팅 계층에서는 고가용성이 지원되지 않습니다.
-   고가용성은 여러 영역을 사용할 수 있는 지역에서만 지원됩니다.
-   다른 가용성 영역에 대한 동기 복제로 인해 애플리케이션에서 쓰기 및 커밋 대기 시간이 증가할 수 있습니다.

-   읽기 쿼리에는 대기 복제본을 사용할 수 없습니다.

-   주 서버의 워크로드 및 작업에 따라 장애 조치(failover) 프로세스는 120초 이상 걸릴 수 있습니다.

-   주 데이터베이스 서버를 다시 시작하면 대기 복제본도 다시 시작됩니다. 

-   추가적인 읽기 전용 복제본 구성은 지원되지 않습니다.

-   관리되는 유지 관리 기간 중에는 고객이 시작한 관리 작업 구성을 예약할 수 없습니다.

-   확장 컴퓨팅 및 확장 스토리지와 같은 계획된 이벤트는 먼저 대기 서버에서 발생한 다음 주 서버에서 발생합니다. 이러한 계획된 작업에 대해 서버가 장애 조치(failover)되지 않습니다. 

-  HA로 구성된 유연한 서버로 논리적 디코딩 또는 논리적 복제를 구성한 경우 대기 서버로 장애 조치(failover) 시 논리적 복제 슬롯이 대기 서버로 복사되지 않습니다.  

## <a name="next-steps"></a>다음 단계

-   [비즈니스 연속성](./concepts-business-continuity.md)에 대해 알아보기
-   [고가용성 관리](./how-to-manage-high-availability-portal.md) 방법 알아보기
-   [백업 및 복구](./concepts-backup-restore.md)에 대해 알아보기