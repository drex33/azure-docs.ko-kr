---
title: 향상 된 사전 사후 스크립트 프레임 워크를 사용 하는 데이터베이스 일치 스냅숏
description: Azure VM 백업을 활용 하 고 패키지 사전 사후 스크립트를 사용 하 여 데이터베이스에 일관 된 스냅숏을 사용 하는 방법에 대해 알아봅니다 Azure Backup
ms.topic: conceptual
ms.date: 09/16/2021
ms.custom: devx-track-azurepowershell
ms.openlocfilehash: fbc8cd150df536df3c65b36d07daa2325eaa4113
ms.sourcegitcommit: f6e2ea5571e35b9ed3a79a22485eba4d20ae36cc
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 09/24/2021
ms.locfileid: "128650104"
---
# <a name="enhanced-pre-post-scripts-for-database-consistent-snapshot"></a>데이터베이스 일관성 스냅숏에 대 한 향상 된 사전 사후 스크립트

Azure Backup 서비스는 Azure Backup를 사용 하 여 Linux Vm에서 응용 프로그램 일관성을 달성할 수 있는 [ _사전 사후_ 스크립트 프레임 워크](./backup-azure-linux-app-consistent.md) 를 제공 합니다. 이렇게 하려면 스냅숏이 완료 된 후 응용 프로그램을 표준 모드로 반환 하기 위해 디스크의 스냅숏을 작성 하 고 사후 스크립트 (응용 프로그램을 중지 하는 명령)를 호출 하기 전에 사전 스크립트 (응용 프로그램을 정지)를 호출 해야 합니다.

E 사전/사후 스크립트를 작성, 디버깅 및 유지 관리 하는 것은 어려울 수 있습니다. 이러한 복잡성을 제거 하기 위해 Azure Backup는 움직이는 텍스트 데이터베이스에 대해 간소화 된 사전/사후 스크립트 환경을 제공 하 여 오버 헤드를 최소화 하면서 응용 프로그램 일치 스냅숏을 가져옵니다.

:::image type="content" source="./media/backup-azure-linux-database-consistent-enhanced-pre-post/linux-application-consistent-snapshot.png" alt-text="Azure Backup에서 Linux 응용 프로그램 일치 스냅숏을 보여 주는 다이어그램":::

_향상_ 된 새 사전 사후 스크립트 프레임 워크는 다음과 같은 주요 이점을 제공 합니다.

- 이러한 사전 사후 스크립트는 백업 확장과 함께 Azure Vm에 직접 설치 됩니다. 이렇게 하면 작성을 제거 하 고 외부 위치에서 다운로드 하는 데 도움이 됩니다.
- [GitHub](https://github.com/Azure/azure-linux-extensions/tree/master/VMBackup/main/workloadPatch/DefaultScripts)에서 사전 사후 스크립트의 정의와 콘텐츠를 볼 수 있으며,이를 통해 제안 및 변경 내용을 제출할 수 있습니다. 더 광범위 한 커뮤니티를 활용 하기 위해 심사 되 고 추가 되는 GitHub를 통해 제안 및 변경 내용을 제출할 수도 있습니다.
- [GitHub](https://github.com/Azure/azure-linux-extensions/tree/master/VMBackup/main/workloadPatch/DefaultScripts)를 통해 다른 데이터베이스에 대 한 새로운 사전 사후 스크립트를 추가할 수도 있습니다 .이 스크립트 _는 더 광범위 한 커뮤니티에 도움이 되도록 심사 되 고 처리 됩니다_.
- 강력한 프레임 워크는 사전 스크립트 실행 오류 또는 충돌과 같은 시나리오를 처리 하는 데 효율적입니다. 모든 이벤트에서 사후 스크립트가 자동으로 실행 되어 사전 스크립트에서 수행 된 모든 변경 내용을 롤백합니다.
- 또한 프레임 워크는 업데이트를 가져오고 모든 메시지/이벤트에 대해 자체 작업 계획을 준비 하는 외부 도구에 대 한 _메시징_ 채널을 제공 합니다.

## <a name="solution-flow-preview"></a>솔루션 흐름 (미리 보기)

:::image type="content" source="./media/backup-azure-linux-database-consistent-enhanced-pre-post/solution-flow.png" alt-text="솔루션 흐름을 보여 주는 다이어그램.":::
## <a name="support-matrix"></a>지원 매트릭스

다음은 향상 된 프레임 워크에서 적용 되는 데이터베이스 목록입니다.

- [Oracle (일반적으로 사용 가능)](../virtual-machines/workloads/oracle/oracle-database-backup-azure-backup.md)
- MySQL(미리 보기)

## <a name="prerequisites"></a>필수 구성 요소

연결 세부 정보를 제공 하기 위해에서 구성 파일, 즉 _작업_ 을 수정 하기만 하면 `/etc/azure` 됩니다. 이렇게 하면 Azure Backup 관련 응용 프로그램에 연결 하 고 사전 및 사후 스크립트를 실행할 수 있습니다. 구성 파일에는 다음과 같은 매개 변수가 있습니다.

```json
[workload]
# valid values are mysql, oracle
workload_name =
command_path = 
linux_user =
credString = 
ipc_folder = 
timeout =
```

다음 표는 매개 변수를 설명합니다.

|매개 변수  |필수  |설명  |
|---------|---------|---------|
|workload_name     |   Yes      |     여기에는 응용 프로그램 일치 백업이 필요한 데이터베이스 이름이 포함 됩니다. 현재 지원 되는 값은 `oracle` 또는 `mysql` 입니다.    |
|command_path/configuration_path     |         |   여기에는 워크 로드 이진에 대 한 경로가 포함 됩니다. 워크 로드 이진이 경로 변수로 설정 된 경우이 필드는 필수가 아닙니다.      |
|linux_user     |    Yes     |   여기에는 데이터베이스 사용자 로그인에 대 한 액세스 권한이 있는 Linux 사용자의 사용자 이름이 포함 됩니다. 이 값이 설정 되지 않은 경우 root는 기본 사용자로 간주 됩니다.      |
|credString     |         |     이는 데이터베이스에 연결 하기 위한 자격 증명 문자열을 의미 합니다. 여기에는 전체 로그인 문자열이 포함 됩니다.    |
|ipc_folder     |         |   작업은 특정 파일 시스템 경로에만 쓸 수 있습니다. 사전 스크립트가이 폴더 경로에 상태를 쓸 수 있도록이 폴더 경로를 여기에 제공 해야 합니다.      |
|시간 제한     |    Yes     |     데이터베이스가 정지 상태인 최대 시간 제한입니다. 기본값은 90초입니다. 60 초 보다 작은 값을 설정 하는 것은 권장 되지 않습니다.    |

> [!NOTE]
> JSON 정의는 Azure Backup 서비스가 특정 데이터베이스에 맞게 수정할 수 있는 템플릿입니다. 각 데이터베이스의 구성 파일을 이해 하려면 [각 데이터베이스의 설명서](#support-matrix)를 참조 하십시오.

향상 된 사전 사후 스크립트 프레임 워크를 사용 하는 전반적인 환경은 다음과 같습니다.

- 데이터베이스 환경 준비
- 구성 파일 편집
- VM 백업 트리거
- 필요에 따라 응용 프로그램 일치 복구 지점에서 Vm 또는 디스크/파일을 복원 합니다.

## <a name="build-a-database-backup-strategy"></a>데이터베이스 백업 전략 작성

### <a name="using-snapshots-instead-of-streaming"></a>스트리밍 대신 스냅숏 사용

일반적으로 데이터베이스 관리자는 백업 전략에서 스트리밍 백업 (예: 전체, 차등 또는 증분) 및 로그를 사용 합니다. 다음은 디자인의 몇 가지 주요 피벗입니다.

- **성능 및 비용**: 일일 전체 + 로그는 복원 중에 가장 빠르며 상당한 비용이 소요 됩니다. 차등/증분 스트리밍 백업 유형을 포함 하면 비용이 줄어들지만 복원 성능에 영향을 줄 수 있습니다. 그러나 스냅숏은 성능 및 비용의 가장 적합 한 조합을 제공 합니다.  스냅숏이 본질적으로 증가 하는 경우 백업 중에 성능에 미치는 영향을 최소화 하 고 신속 하 게 복원 하 고 비용을 절감할 수도 있습니다.
- **데이터베이스/인프라에 미치는 영향**: 스트리밍 백업의 성능은 원본 저장소 IOPS 및 스트림의 대상이 원격 위치를 지정 하는 경우 사용 가능한 네트워크 대역폭에 따라 달라 집니다. 스냅숏에는 이러한 종속성이 없으며 IOPS 및 네트워크 대역폭에 대 한 요구가 크게 줄어듭니다.
- **사용 편리성**: 각 데이터베이스 마다 다른 스트리밍 백업 유형을 트리거하는 명령이 서로 다릅니다. 따라서 스크립트를 쉽게 다시 사용할 수 없습니다. 또한 다른 백업 유형을 사용 하는 경우에는 종속성 체인을 평가 하 여 수명 주기를 유지 해야 합니다. 스냅숏의 경우 종속성 체인이 없기 때문에 스크립트를 작성 하는 것이 쉽습니다.
- **장기 보존**: 전체 백업은 독립적으로 이동 하 고 복구할 수 있는 장기 retention0에 항상 유용 합니다. 그러나 단기 보존이 있는 운영 백업의 경우 스냅숏은 매우 유용 합니다.

따라서 장기 보존을 위해 가끔씩 전체 백업이 있는 일별 스냅숏 + 로그는 데이터베이스에 대 한 최상의 백업 정책입니다.

### <a name="log-backup-strategy"></a>로그 백업 전략

향상 된 사전 사후 스크립트 프레임 워크는 하루에 한 번 백업을 예약 하는 Azure VM backup을 기반으로 합니다. 따라서 RPO가 24 시간인 데이터 손실 창은 프로덕션 데이터베이스에 적합 하지 않습니다. 이 솔루션은 로그 백업이 명시적으로 스트리밍되는 로그 백업 전략을 보완 합니다.

[Blob의 nfs](../storage/blobs/network-file-system-protocol-support.md) 및 [AFS (미리 보기)의 Nfs](../storage/files/files-nfs-protocol.md) 는 데이터베이스 vm에서 직접 볼륨을 쉽게 탑재 하 고 데이터베이스 클라이언트를 사용 하 여 로그 백업을 전송 하는 데 도움이 됩니다. 데이터 손실 창 (RPO)은 로그 백업 빈도에 해당 합니다. 또한 데이터베이스 일관성 스냅숏이 있는 후에는 운영 백업에 대 한 일반 스트리밍 (전체 및 증분)을 트리거하지 않아도 되므로 NFS 대상은 매우 효율적으로 사용할 필요가 없습니다.

>[!NOTE]
>향상 된 사전 스크립트는 일반적으로 데이터베이스를 정지 하 여 스냅숏을 만들기 전에 로그 백업 대상으로 전송 중인 모든 로그 트랜잭션을 플러시합니다. 따라서 스냅숏은 복구 중에 데이터베이스 일관성과 안정성이 높습니다.

### <a name="recovery-strategy"></a>복구 전략

데이터베이스 일치 스냅숏이 생성 되 고 로그 백업이 NFS 볼륨으로 스트리밍되 면 데이터베이스의 복구 전략은 Azure VM 백업의 복구 기능을 사용할 수 있습니다. 데이터베이스 클라이언트를 사용 하 여 로그 백업 기능이 추가로 적용 됩니다. 다음은 복구 전략의 몇 가지 옵션입니다.

- 데이터베이스 일치 복구 지점에서 새 Vm을 만듭니다. VM에는 로그 탑재 지점이 이미 연결 되어 있어야 합니다. 데이터베이스 클라이언트를 사용 하 여 지정 시간 복구에 대 한 복구 명령을 실행할 수 있습니다.
- 데이터베이스 일치 복구 지점에서 디스크를 만들어 다른 대상 VM에 연결 합니다. 그런 다음 로그 대상을 탑재 하 고 데이터베이스 클라이언트를 사용 하 여 지정 시간 복구에 대 한 복구 명령을 실행 합니다.
- 파일 복구 옵션을 사용 하 여 스크립트를 생성 합니다. 대상 VM에서 스크립트를 실행 하 고 iSCSI 디스크로 복구 지점을 연결 합니다. 그런 다음 데이터베이스 클라이언트를 사용 하 여 연결 된 디스크에 대 한 데이터베이스 관련 유효성 검사 함수를 실행 하 고 백업 데이터의 유효성을 검사 합니다. 또한 데이터베이스 클라이언트를 사용 하 여 전체 데이터베이스를 복구 하는 대신 몇 개의 테이블/파일을 내보내거나 복구할 수 있습니다.
- 지역 재해 시 지역 간 복원 기능을 사용 하 여 보조 쌍으로 연결 된 지역에서 위의 작업을 수행 합니다.

## <a name="summary"></a>요약

사용자 지정 솔루션을 사용 하 여 백업 된 데이터베이스 일관성 스냅숏 + 로그를 사용 하 여 Azure VM 백업의 이점을 활용 하 고 데이터베이스 클라이언트의 기능을 다시 사용 하 여 성능과 비용 효율적인 데이터베이스 백업 솔루션을 구축할 수 있습니다.
